<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Detective - MiniPhone Simulator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=SF+Pro+Display:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ios-blue: #007AFF;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
            --ios-yellow: #FFCC00;
            --ios-purple: #AF52DE;
            --ios-pink: #FF2D55;
            --ios-gray: #8E8E93;
            --ios-gray-light: #F2F2F7;
            --ios-gray-dark: #1C1C1E;
            --suspicious-yellow: #FFF3CD;
            --suspicious-border: #FFD700;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            gap: 30px;
        }

        /* Detective Notebook Panel */
        .detective-panel {
            width: 380px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        /* Info Panel */
        .info-panel {
            width: 380px;
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .info-header {
            background: linear-gradient(135deg, #FF9500, #FFCC00);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .info-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .info-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
            color: #333;
        }

        .info-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--ios-blue);
        }

        .info-card h4 {
            color: var(--ios-blue);
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .info-card.warning {
            background: #fff5f5;
            border-left-color: var(--ios-red);
        }

        .info-card.warning h4 {
            color: var(--ios-red);
        }

        .info-card.success {
            background: #e8f5e9;
            border-left-color: var(--ios-green);
        }

        .info-card.success h4 {
            color: var(--ios-green);
        }

        .notebook-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .notebook-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .notebook-header p {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        .notebook-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .mission-section {
            margin-bottom: 20px;
        }

        .mission-section h3 {
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mission-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 12px 15px;
            margin-bottom: 8px;
            display: flex;
            flex-direction: column;
            /* Changed to column for checklist */
            gap: 12px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .mission-header-row {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            width: 100%;
            cursor: pointer;
        }

        .mission-checklist {
            display: none;
            padding-left: 36px;
            margin-top: 5px;
            width: 100%;
        }

        .mission-item.active .mission-checklist {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
            font-size: 0.85rem;
            color: #555;
        }

        .checklist-item i {
            color: var(--ios-blue);
            margin-top: 3px;
        }

        .mission-item.completed {
            background: #e8f5e9;
            border-color: var(--ios-green);
        }

        .mission-item.active {
            background: #e3f2fd;
            border-color: var(--ios-blue);
        }

        .mission-checkbox {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
        }

        .mission-item.completed .mission-checkbox {
            background: var(--ios-green);
            border-color: var(--ios-green);
            color: white;
        }

        .mission-text {
            flex: 1;
        }

        .mission-text strong {
            display: block;
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .mission-text span {
            font-size: 0.8rem;
            color: #666;
        }

        /* Data Footprint Visualizer */
        .footprint-section {
            background: linear-gradient(135deg, #fff5f5, #fff);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #ffcdd2;
        }

        .footprint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .footprint-header h3 {
            font-size: 0.9rem;
            color: #c62828;
        }

        .footprint-score {
            background: linear-gradient(135deg, #c62828, #e53935);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .footprint-items {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .footprint-item {
            background: white;
            border: 1px solid #ffcdd2;
            border-radius: 20px;
            padding: 6px 12px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 6px;
            animation: popIn 0.3s ease;
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .footprint-item i {
            color: var(--ios-red);
        }

        .footprint-empty {
            text-align: center;
            padding: 20px;
            color: #999;
            font-size: 0.85rem;
        }

        /* Discoveries Section */
        .discoveries-section {
            margin-top: 20px;
        }

        .discovery-item {
            background: var(--suspicious-yellow);
            border: 2px solid var(--suspicious-border);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            animation: pulseGold 2s infinite;
        }

        @keyframes pulseGold {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4);
            }

            50% {
                box-shadow: 0 0 0 8px rgba(255, 215, 0, 0);
            }
        }

        .discovery-item strong {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            margin-bottom: 5px;
        }

        .discovery-item p {
            font-size: 0.8rem;
            color: #666;
        }

        /* Phone Container */
        .phone-container {
            width: 380px;
            height: 820px;
            background: #000;
            border-radius: 55px;
            padding: 12px;
            box-shadow: 0 50px 100px rgba(0, 0, 0, 0.5), inset 0 0 0 2px #333;
            position: relative;
        }

        .phone-screen {
            width: 100%;
            height: 100%;
            background: var(--ios-gray-light);
            border-radius: 45px;
            overflow: hidden;
            position: relative;
        }

        /* Status Bar */
        .status-bar {
            height: 50px;
            background: transparent;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 25px 8px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
        }

        .status-bar.dark {
            color: white;
        }

        .status-bar.light {
            color: black;
        }

        .status-time {
            font-weight: 600;
            font-size: 15px;
        }

        .status-icons {
            display: flex;
            gap: 5px;
            font-size: 14px;
        }

        .dynamic-notch {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            width: 125px;
            height: 35px;
            background: #000;
            border-radius: 20px;
            z-index: 101;
        }

        /* Home Screen */
        .home-screen {
            height: 100%;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            padding: 70px 20px 30px;
            display: flex;
            flex-direction: column;
        }

        .home-wallpaper-text {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .home-wallpaper-text .date {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .home-wallpaper-text .time {
            font-size: 4rem;
            font-weight: 200;
            letter-spacing: -2px;
        }

        .app-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px 15px;
            flex: 1;
        }

        .app-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .app-icon:hover {
            transform: scale(1.1);
        }

        .app-icon:active {
            transform: scale(0.95);
        }

        .app-icon-img {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
            position: relative;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .app-icon.locked {
            filter: grayscale(1);
            opacity: 0.7;
            cursor: not-allowed;
        }

        .app-icon.locked::after {
            content: '\f023';
            /* FontAwesome lock icon */
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            top: -5px;
            right: -5px;
            background: #333;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #fff;
        }

        .app-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--ios-red);
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .app-icon-label {
            color: white;
            font-size: 11px;
            text-align: center;
        }

        /* App Colors */
        .app-messages {
            background: linear-gradient(135deg, #34C759, #30B350);
        }

        .app-browser {
            background: linear-gradient(135deg, #007AFF, #0055FF);
        }

        .app-connectify {
            background: linear-gradient(135deg, #FF2D55, #FF375F);
        }

        .app-mapme {
            background: linear-gradient(135deg, #5856D6, #4240B0);
        }

        .app-skywatch {
            background: linear-gradient(135deg, #FF9500, #FF7B00);
        }

        .app-settings {
            background: linear-gradient(135deg, #8E8E93, #636366);
        }

        .app-freegame {
            background: linear-gradient(135deg, #AF52DE, #9240C7);
        }

        /* Home Indicator */
        .home-indicator {
            width: 135px;
            height: 5px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            margin: auto auto 10px;
        }

        /* App Screens */
        .app-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.35s cubic-bezier(0.32, 0.72, 0, 1);
            display: flex;
            flex-direction: column;
            z-index: 50;
        }

        .app-screen.active {
            transform: translateX(0);
            opacity: 1;
        }

        .app-header {
            background: var(--ios-gray-light);
            padding: 60px 15px 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-bottom: 1px solid #e0e0e0;
        }

        .app-header-back {
            color: var(--ios-blue);
            font-size: 1.1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .app-header-title {
            flex: 1;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .app-body {
            flex: 1;
            overflow-y: auto;
            background: var(--ios-gray-light);
        }

        /* Messages App */
        .messages-container {
            padding: 15px;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 20px;
            margin-bottom: 8px;
            font-size: 0.95rem;
            line-height: 1.4;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-received {
            background: #e9e9eb;
            color: black;
            border-bottom-left-radius: 5px;
            margin-right: auto;
        }

        .message-sent {
            background: var(--ios-blue);
            color: white;
            border-bottom-right-radius: 5px;
            margin-left: auto;
        }

        .message-sender {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 4px;
            font-weight: 600;
        }

        .message-mission {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            border: 2px solid var(--ios-green);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
        }

        .message-mission h4 {
            color: #2e7d32;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-mission p {
            font-size: 0.9rem;
            color: #333;
        }

        .message-mission ul {
            margin: 10px 0 0 20px;
            font-size: 0.85rem;
        }

        .message-mission li {
            margin-bottom: 5px;
        }

        /* Permission Dialog */
        /* Investigation Guide Modal */
        .instruction-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }

        .instruction-modal.active {
            display: flex;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .instruction-header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .instruction-header h2 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 0;
        }

        .instruction-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
            font-size: 1.2rem;
        }

        .instruction-close:hover {
            background: rgba(255, 255, 255, 0.4);
        }

        .instruction-body {
            padding: 30px;
            font-size: 1rem;
            line-height: 1.6;
            color: #333;
            overflow-y: auto;
            flex: 1;
        }

        .instruction-body h3 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 25px;
            margin-bottom: 15px;
        }

        .instruction-body h3:first-child {
            margin-top: 0;
        }

        .instruction-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
        }

        .instruction-table th,
        .instruction-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .instruction-table th {
            background: #e9ecef;
            font-weight: 600;
            color: #495057;
        }

        .instruction-table tr:last-child td {
            border-bottom: none;
        }

        .notebook-task {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .notebook-task h4 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 0;
        }

        .notebook-task p {
            margin: 10px 0;
        }

        .notebook-task ul {
            margin: 10px 0;
            padding-left: 25px;
        }

        .instruction-content {
            background: #fff;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            display: flex;
            flex-direction: column;
            animation: slideUp 0.4s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .permission-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .permission-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .permission-dialog {
            background: white;
            border-radius: 20px;
            width: 85%;
            max-width: 300px;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s ease;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .permission-overlay.active .permission-dialog {
            transform: scale(1);
        }

        .permission-content {
            padding: 25px 20px;
            text-align: center;
        }

        .permission-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .permission-title {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .permission-description {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.5;
        }

        .permission-buttons {
            border-top: 1px solid #e0e0e0;
        }

        .permission-btn {
            width: 100%;
            padding: 15px;
            border: none;
            background: none;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }

        .permission-btn:hover {
            background: #f5f5f5;
        }

        .permission-btn:not(:last-child) {
            border-bottom: 1px solid #e0e0e0;
        }

        .permission-btn.primary {
            color: var(--ios-blue);
            font-weight: 600;
        }

        .permission-btn.danger {
            color: var(--ios-red);
        }

        .permission-btn.secondary {
            color: var(--ios-gray);
        }

        /* Cookie Banner */
        .cookie-banner {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
            transform: translateY(100%);
            transition: transform 0.4s ease;
            z-index: 150;
        }

        .cookie-banner.active {
            transform: translateY(0);
        }

        .cookie-content {
            padding: 25px 20px;
        }

        .cookie-title {
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .cookie-text {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .cookie-options {
            margin-bottom: 20px;
        }

        .cookie-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .cookie-option-info h4 {
            font-size: 0.9rem;
            margin-bottom: 3px;
        }

        .cookie-option-info p {
            font-size: 0.75rem;
            color: #888;
        }

        .toggle-switch {
            width: 50px;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: var(--ios-green);
        }

        .toggle-switch.locked {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 26px;
            height: 26px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .cookie-buttons {
            display: flex;
            gap: 10px;
        }

        .cookie-btn {
            flex: 1;
            padding: 14px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .cookie-btn.accept-all {
            background: var(--ios-blue);
            color: white;
        }

        .cookie-btn.accept-selected {
            background: #e0e0e0;
            color: #333;
        }

        /* Terms & Conditions */
        .terms-screen {
            background: white;
        }

        .terms-content {
            padding: 20px;
            font-size: 0.85rem;
            line-height: 1.7;
            color: #333;
        }

        .terms-section {
            margin-bottom: 20px;
        }

        .terms-section h3 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #000;
        }

        .terms-clause {
            padding: 12px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #ddd;
        }

        .terms-clause.suspicious {
            background: var(--suspicious-yellow);
            border-left-color: var(--suspicious-border);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .terms-clause.suspicious:hover {
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .terms-clause.suspicious::after {
            content: 'üîç Click to investigate';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #b8860b;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .terms-clause.suspicious:hover::after {
            opacity: 1;
        }

        .terms-clause.discovered {
            background: #c8e6c9;
            border-left-color: var(--ios-green);
        }

        .terms-clause.discovered::before {
            content: '‚úì Discovered! ';
            font-weight: 600;
            color: var(--ios-green);
        }

        .terms-buttons {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-top: 1px solid #eee;
        }

        .terms-btn {
            padding: 15px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .terms-btn.agree {
            background: var(--ios-blue);
            color: white;
        }

        .terms-btn.decline {
            background: #f0f0f0;
            color: #666;
        }

        /* Browser App */
        .browser-url-bar {
            background: white;
            margin: 15px;
            padding: 12px 15px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .browser-content {
            background: white;
            margin: 0 15px 15px;
            border-radius: 15px;
            padding: 20px;
            min-height: 400px;
        }

        .website-header {
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
            margin-bottom: 20px;
        }

        .website-header h2 {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .website-header p {
            color: #666;
            font-size: 0.85rem;
        }

        .ad-container {
            background: #f8f9fa;
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .ad-container.personalized {
            background: linear-gradient(135deg, #fff5f5, #ffe5e5);
            border-color: var(--ios-red);
            border-style: solid;
        }

        .ad-container h4 {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 10px;
        }

        .ad-content {
            font-size: 0.95rem;
        }

        .ad-content.creepy {
            color: var(--ios-red);
        }

        /* Map App */
        .map-container {
            height: 300px;
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            margin: 15px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .map-grid {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(rgba(0, 0, 0, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.05) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .map-marker {
            position: absolute;
            font-size: 2rem;
            animation: bounce 1s infinite;
        }

        .map-marker.precise {
            color: var(--ios-red);
        }

        .map-marker.approximate {
            color: var(--ios-blue);
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .map-radius {
            position: absolute;
            border-radius: 50%;
            border: 3px dashed;
            animation: pulse 2s infinite;
        }

        .map-radius.approximate {
            width: 150px;
            height: 150px;
            border-color: var(--ios-blue);
            background: rgba(0, 122, 255, 0.1);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .map-info {
            background: white;
            margin: 0 15px 15px;
            border-radius: 15px;
            padding: 20px;
        }

        .location-status {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin-bottom: 15px;
        }

        .location-status i {
            font-size: 1.5rem;
        }

        .location-status.precise i {
            color: var(--ios-red);
        }

        .location-status.approximate i {
            color: var(--ios-blue);
        }

        .location-status.denied i {
            color: var(--ios-gray);
        }

        /* Weather App */
        .weather-container {
            text-align: center;
            padding: 40px 20px;
        }

        .weather-icon {
            font-size: 5rem;
            margin-bottom: 20px;
        }

        .weather-temp {
            font-size: 4rem;
            font-weight: 200;
        }

        .weather-location {
            font-size: 1.2rem;
            color: #666;
            margin-top: 10px;
        }

        .weather-location.vague {
            color: var(--ios-blue);
        }

        .weather-location.precise {
            color: var(--ios-red);
        }

        .weather-details {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 30px;
        }

        .weather-detail {
            text-align: center;
        }

        .weather-detail i {
            font-size: 1.5rem;
            color: #666;
            margin-bottom: 5px;
        }

        .weather-detail span {
            display: block;
            font-size: 0.9rem;
        }

        /* Social App */
        .social-feed {
            padding: 15px;
        }

        .social-post {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .social-post-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .social-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .social-user-info h4 {
            font-size: 0.95rem;
        }

        .social-user-info span {
            font-size: 0.8rem;
            color: #666;
        }

        .nearby-feature {
            background: linear-gradient(135deg, #fff5f5, #ffe5e5);
            border: 2px solid var(--ios-red);
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            text-align: center;
        }

        .nearby-feature.disabled {
            background: #f5f5f5;
            border-color: #ddd;
            opacity: 0.7;
        }

        .nearby-feature h3 {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .nearby-list {
            text-align: left;
        }

        .nearby-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px;
            background: white;
            border-radius: 10px;
            margin-top: 10px;
        }

        .nearby-item .distance {
            color: var(--ios-red);
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Settings Screen */
        .settings-section {
            background: white;
            margin: 15px;
            border-radius: 15px;
            overflow: hidden;
        }

        .settings-header {
            padding: 12px 15px;
            background: #f8f9fa;
            font-weight: 600;
            font-size: 0.85rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-icon {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            color: white;
            font-size: 0.9rem;
        }

        .settings-item-info {
            flex: 1;
        }

        .settings-item-info h4 {
            font-size: 0.95rem;
            font-weight: 500;
        }

        .settings-item-info span {
            font-size: 0.8rem;
            color: #666;
        }

        .settings-value {
            font-size: 0.9rem;
            color: var(--ios-gray);
        }

        /* Game App */
        .game-container {
            padding: 20px;
            text-align: center;
        }

        .game-preview {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 20px;
            padding: 40px 20px;
            color: white;
            margin-bottom: 20px;
        }

        .game-preview h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .game-preview p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .game-blocked {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 30px;
        }

        .game-blocked i {
            font-size: 3rem;
            color: #ccc;
            margin-bottom: 15px;
        }

        .game-blocked h3 {
            margin-bottom: 10px;
        }

        .game-blocked p {
            font-size: 0.9rem;
            color: #666;
        }

        /* Toast Notifications */
        .toast-container {
            position: absolute;
            top: 70px;
            left: 15px;
            right: 15px;
            z-index: 300;
        }

        .toast {
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: toastIn 0.3s ease;
            backdrop-filter: blur(10px);
        }

        @keyframes toastIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .toast.success {
            background: rgba(52, 199, 89, 0.95);
        }

        .toast.warning {
            background: rgba(255, 149, 0, 0.95);
        }

        .toast.danger {
            background: rgba(255, 59, 48, 0.95);
        }

        .toast.discovery {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.95), rgba(255, 193, 7, 0.95));
            color: #333;
        }

        .toast i {
            font-size: 1.2rem;
        }

        .toast-content {
            flex: 1;
        }

        .toast-content strong {
            display: block;
            margin-bottom: 3px;
        }

        .toast-content span {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        /* Investigation Complete Modal */
        .complete-modal {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 400;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .complete-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .complete-content {
            background: white;
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            width: 85%;
            max-width: 300px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }

        .complete-modal.active .complete-content {
            transform: scale(1);
        }

        .complete-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .complete-content h2 {
            margin-bottom: 10px;
        }

        .complete-content p {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }

        .complete-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .complete-stat {
            text-align: center;
        }

        .complete-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--ios-blue);
        }

        .complete-stat-label {
            font-size: 0.75rem;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 900px) {
            body {
                flex-direction: column;
                align-items: center;
            }

            .detective-panel,
            .info-panel {
                position: static;
                width: 100%;
                max-width: 375px;
                max-height: none;
            }

            .info-panel {
                order: 3;
            }
        }

        @media (max-width: 400px) {
            .phone-container {
                width: 100%;
                height: auto;
                aspect-ratio: 375/812;
                border-radius: 40px;
                padding: 8px;
            }

            .phone-screen {
                border-radius: 35px;
            }
        }

        /* Sequential Alert System */
        .sequential-alert-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(3px);
        }

        .sequential-alert-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .alert-box {
            background: white;
            width: 90%;
            max-width: 350px;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transform: scale(0.9);
            transition: transform 0.3s ease;
            position: relative;
        }

        .sequential-alert-overlay.active .alert-box {
            transform: scale(1);
        }

        .alert-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .alert-box.warning .alert-icon {
            color: var(--ios-orange);
        }

        .alert-box.danger .alert-icon {
            color: var(--ios-red);
        }

        .alert-box.info .alert-icon {
            color: var(--ios-blue);
        }

        .alert-message {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        .alert-dismiss {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #999;
            cursor: pointer;
            padding: 5px;
        }

        .alert-dismiss:hover {
            color: #333;
        }

        .alert-btn {
            background: var(--ios-blue);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .alert-btn:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body>
    <!-- Detective Notebook Panel -->
    <div class="detective-panel">
        <div class="notebook-header">
            <h2><i class="fa-solid fa-magnifying-glass"></i> Detective Notebook</h2>
            <p>Track your investigation progress</p>
        </div>
        <div class="notebook-content">
            <!-- Missions -->
            <div class="mission-section">
                <h3><i class="fa-solid fa-list-check"></i> Missions</h3>
                <div id="mission-list">
                    <!-- Browser Mission -->
                    <div class="mission-item active" data-mission="browser">
                        <div class="mission-header-row">
                            <div class="mission-checkbox"></div>
                            <div class="mission-text">
                                <strong>üåê Browser Investigation</strong>
                                <span>Explore cookie settings</span>
                            </div>
                        </div>
                        <div class="mission-checklist">
                            <button class="guide-btn" onclick="openInstructionModal('browser')">
                                <i class="fa-solid fa-folder-open"></i> View Investigation Guide
                            </button>
                        </div>
                    </div>

                    <!-- Connectify Mission -->
                    <div class="mission-item" data-mission="connectify">
                        <div class="mission-header-row">
                            <div class="mission-checkbox"></div>
                            <div class="mission-text">
                                <strong>üí¨ Connectify Analysis</strong>
                                <span>Find suspicious terms</span>
                            </div>
                        </div>
                        <div class="mission-checklist">
                            <button class="guide-btn" onclick="openInstructionModal('connectify')">
                                <i class="fa-solid fa-folder-open"></i> View Investigation Guide
                            </button>
                        </div>
                    </div>

                    <!-- MapMe Mission -->
                    <div class="mission-item" data-mission="mapme">
                        <div class="mission-header-row">
                            <div class="mission-checkbox"></div>
                            <div class="mission-text">
                                <strong>üó∫Ô∏è MapMe Exploration</strong>
                                <span>Precise vs Approximate</span>
                            </div>
                        </div>
                        <div class="mission-checklist">
                            <button class="guide-btn" onclick="openInstructionModal('mapme')">
                                <i class="fa-solid fa-folder-open"></i> View Investigation Guide
                            </button>
                        </div>
                    </div>

                    <!-- SkyWatch Mission -->
                    <div class="mission-item" data-mission="skywatch">
                        <div class="mission-header-row">
                            <div class="mission-checkbox"></div>
                            <div class="mission-text">
                                <strong>üå§Ô∏è SkyWatch Test</strong>
                                <span>Weather data privacy</span>
                            </div>
                        </div>
                        <div class="mission-checklist">
                            <button class="guide-btn" onclick="openInstructionModal('skywatch')">
                                <i class="fa-solid fa-folder-open"></i> View Investigation Guide
                            </button>
                        </div>
                    </div>

                    <!-- FreeGame Mission -->
                    <div class="mission-item" data-mission="freegame">
                        <div class="mission-header-row">
                            <div class="mission-checkbox"></div>
                            <div class="mission-text">
                                <strong>üéÆ FreeGame Truth</strong>
                                <span>The cost of "Free"</span>
                            </div>
                        </div>
                        <div class="mission-checklist">
                            <button class="guide-btn" onclick="openInstructionModal('freegame')">
                                <i class="fa-solid fa-folder-open"></i> View Investigation Guide
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Discoveries -->
            <div class="mission-section discoveries-section">
                <h3><i class="fa-solid fa-lightbulb"></i> Discoveries</h3>
                <div id="discoveries-list">
                    <p style="color: #999; font-size: 0.85rem; text-align: center; padding: 15px;">
                        Investigate apps to find hidden secrets! Look for suspicious clauses highlighted in yellow.
                    </p>
                </div>
            </div>

            <!-- Data Footprint -->
            <div class="footprint-section">
                <div class="footprint-header">
                    <h3><i class="fa-solid fa-shoe-prints"></i> Your Data Footprint</h3>
                    <div class="footprint-score" id="footprint-score">0 items</div>
                </div>
                <div class="footprint-items" id="footprint-items">
                    <div class="footprint-empty">
                        <i class="fa-solid fa-shield-halved" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>No data collected yet.<br>Grant permissions to see what apps learn about you!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Phone -->
    <div class="phone-container">
        <div class="phone-screen">
            <div class="dynamic-notch"></div>
            <div class="status-bar dark" id="status-bar">
                <span class="status-time">9:41</span>
                <span class="status-icons">
                    <i class="fa-solid fa-signal"></i>
                    <i class="fa-solid fa-wifi"></i>
                    <i class="fa-solid fa-battery-full"></i>
                </span>
            </div>

            <!-- Toast Container -->
            <div class="toast-container" id="toast-container"></div>

            <!-- Home Screen -->
            <div class="home-screen" id="home-screen">
                <div class="home-wallpaper-text">
                    <div class="date">Monday, December 2</div>
                    <div class="time">9:41</div>
                </div>
                <div class="app-grid">
                    <div class="app-icon" data-app="messages">
                        <div class="app-icon-img app-messages">
                            <i class="fa-solid fa-message"></i>
                            <span class="app-badge" id="messages-badge">4</span>
                        </div>
                        <span class="app-icon-label">Messages</span>
                    </div>
                    <div class="app-icon" data-app="browser">
                        <div class="app-icon-img app-browser">
                            <i class="fa-solid fa-compass"></i>
                        </div>
                        <span class="app-icon-label">Browser</span>
                    </div>
                    <div class="app-icon" data-app="connectify">
                        <div class="app-icon-img app-connectify">
                            <i class="fa-solid fa-heart"></i>
                        </div>
                        <span class="app-icon-label">Connectify</span>
                    </div>
                    <div class="app-icon" data-app="mapme">
                        <div class="app-icon-img app-mapme">
                            <i class="fa-solid fa-map-location-dot"></i>
                        </div>
                        <span class="app-icon-label">MapMe</span>
                    </div>
                    <div class="app-icon" data-app="skywatch">
                        <div class="app-icon-img app-skywatch">
                            <i class="fa-solid fa-cloud-sun"></i>
                        </div>
                        <span class="app-icon-label">SkyWatch</span>
                    </div>
                    <div class="app-icon" data-app="settings">
                        <div class="app-icon-img app-settings">
                            <i class="fa-solid fa-gear"></i>
                        </div>
                        <span class="app-icon-label">Settings</span>
                    </div>
                    <div class="app-icon" data-app="freegame">
                        <div class="app-icon-img app-freegame">
                            <i class="fa-solid fa-gamepad"></i>
                        </div>
                        <span class="app-icon-label">FreeGame</span>
                    </div>
                </div>
                <div class="home-indicator"></div>
            </div>

            <!-- Messages App -->
            <div class="app-screen" id="app-messages">
                <div class="app-header">
                    <div class="app-header-back" onclick="goHome()">
                        <i class="fa-solid fa-chevron-left"></i> Back
                    </div>
                    <div class="app-header-title">HQ Messages</div>
                </div>
                <div class="app-body">
                    <div class="messages-container" id="messages-content">
                        <div class="message-sender">üïµÔ∏è Detective HQ</div>
                        <div class="message-bubble message-received">
                            Welcome, Detective! üëã
                        </div>
                        <div class="message-bubble message-received">
                            Your mission: investigate the apps on this phone and discover what data they're secretly
                            collecting about you.
                        </div>
                        <div class="message-mission">
                            <h4><i class="fa-solid fa-bullseye"></i> Your First Mission</h4>
                            <p>Open the <strong>Browser</strong> app and investigate the cookie banner:</p>
                            <ul>
                                <li>Try accepting ALL cookies - watch what happens to the ads</li>
                                <li>Then reset and try NECESSARY only</li>
                                <li>What's the difference? ü§î</li>
                            </ul>
                        </div>
                        <div class="message-bubble message-received">
                            Report back here after each investigation. I'll send you new missions as you complete them!
                        </div>
                        <div class="message-bubble message-received">
                            <strong>Pro Tip:</strong> Look for text highlighted in <span
                                style="background: #FFF3CD; padding: 2px 6px; border-radius: 4px;">yellow</span> - these
                            are suspicious clauses hiding important information!
                        </div>
                    </div>
                </div>

                function updateMessages() {
                const list = document.getElementById('message-list');
                list.innerHTML = ''; // Clear current list

                // Initial Welcome Message
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Briefing',
                preview: 'Welcome to the Digital Footprint Unit...',
                time: '09:00',
                read: true, // Initial message is read
                action: 'unlock_browser'
                });

                // Mission 1 Complete -> Unlock Connectify
                if (appState.completedMissions.includes('browser')) {
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Update: Cookies',
                preview: 'Good work analyzing those cookies. Next target ready...',
                time: '09:15',
                read: appState.unlockedApps.includes('connectify'),
                action: 'unlock_connectify'
                });
                }

                // Mission 2 Complete -> Unlock MapMe
                if (appState.completedMissions.includes('connectify')) {
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Update: Terms',
                preview: 'You found the hidden clauses! New location app detected...',
                time: '09:30',
                read: appState.unlockedApps.includes('mapme'),
                action: 'unlock_mapme'
                });
                }

                // Mission 3 Complete -> Unlock SkyWatch
                if (appState.completedMissions.includes('mapme')) {
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Update: Location',
                preview: 'Precise location is risky. Check this weather app...',
                time: '09:45',
                read: appState.unlockedApps.includes('skywatch'),
                action: 'unlock_skywatch'
                });
                }

                // Mission 4 Complete -> Unlock FreeGame
                if (appState.completedMissions.includes('skywatch')) {
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Update: Permissions',
                preview: 'Data minimization applied. One last game to check...',
                time: '10:00',
                read: appState.unlockedApps.includes('freegame'),
                action: 'unlock_freegame'
                });
                }

                // Mission 5 Complete -> Finish
                if (appState.completedMissions.includes('freegame')) {
                addMessageToUI({
                sender: 'Headquarters',
                subject: 'Mission Complete!',
                preview: 'Excellent work Detective! You have secured the device.',
                time: '10:15',
                read: false,
                action: 'finish'
                });
                }
                }

                function addMessageToUI(msg) {
                const list = document.getElementById('message-list');
                const item = document.createElement('div');
                item.className = `message-item ${msg.read ? '' : 'unread'}`;
                item.onclick = () => openMessage(msg);

                item.innerHTML = `
                <div class="message-avatar"><i class="fa-solid fa-user-secret"></i></div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="sender">${msg.sender}</span>
                        <span class="time">${msg.time}</span>
                    </div>
                    <div class="subject">${msg.subject}</div>
                    <div class="preview">${msg.preview}</div>
                </div>
                ${msg.read ? '' : '<div class="unread-dot"></div>'}
                `;
                list.appendChild(item);
                }

                function openMessage(msg) {
                // Logic to handle message opening and unlocking
                if (!msg.read) {
                // Mark as read (visually handled by re-render usually, but here we trigger action)
                if (msg.action === 'unlock_browser') unlockApp('browser');
                if (msg.action === 'unlock_connectify') unlockApp('connectify');
                if (msg.action === 'unlock_mapme') unlockApp('mapme');
                if (msg.action === 'unlock_skywatch') unlockApp('skywatch');
                if (msg.action === 'unlock_freegame') unlockApp('freegame');

                // Remove badge if all read
                const msgIcon = document.querySelector('.app-icon[onclick="openApp(\'messages\')"]');
                const badge = msgIcon.querySelector('.notification-badge');
                if (badge) badge.remove();

                // Re-render messages to show as read
                // In a real app we'd update state, here we cheat a bit by forcing re-render
                // But wait! updateMessages uses appState.unlockedApps to determine read status.
                // So calling unlockApp updates state, then we call updateMessages()
                setTimeout(updateMessages, 100);

                showToast(`üîì Access Granted: ${msg.subject.split(': ')[1] || 'App'}`, 'success');
                }

                // Show message detail (simple alert for now or modal?)
                // User didn't specify, but "read the message" implies seeing it.
                // Let's use a simple alert or reuse the sequential alert for reading?
                // Or just the toast is enough? User said "must read the message".
                // Let's show a sequential alert with the full message content.

                showSequentialAlert(`
                <h3>${msg.subject}</h3>
                <p>${msg.preview}</p>
                <p><em>Access code received. Unlocking next app...</em></p>
                `, 'info');
                }
                <!-- Browser App -->
                <div class="app-screen" id="app-browser">
                    <div class="app-header">
                        <div class="app-header-back" onclick="goHome()">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title">Browser</div>
                    </div>
                    <div class="app-body" id="browser-body">
                        <div class="browser-url-bar">
                            <i class="fa-solid fa-lock"></i>
                            <span>www.shop-everything.com</span>
                        </div>
                        <div class="browser-content" id="browser-content">
                            <div class="website-header">
                                <h2>üõí ShopEverything</h2>
                                <p>Your one-stop online store</p>
                            </div>
                            <div class="ad-container" id="ad-container">
                                <h4>üì¢ ADVERTISEMENT</h4>
                                <div class="ad-content" id="ad-content">
                                    <p style="color: #999;">Loading advertisement...</p>
                                </div>
                            </div>
                            <p style="color: #666; font-size: 0.9rem;">Welcome to ShopEverything! Browse our amazing
                                deals
                                on electronics, clothing, and more.</p>
                        </div>
                    </div>

                    <!-- Cookie Banner -->
                    <div class="cookie-banner" id="cookie-banner">
                        <div class="cookie-content">
                            <div class="cookie-title">
                                <i class="fa-solid fa-cookie-bite"></i> Cookie Settings
                            </div>
                            <p class="cookie-text">
                                We use cookies to improve your experience. You can choose which cookies to accept.
                            </p>
                            <div class="cookie-options">
                                <div class="cookie-option">
                                    <div class="cookie-option-info">
                                        <h4>Necessary Cookies</h4>
                                        <p>Required for the website to work</p>
                                    </div>
                                    <div class="toggle-switch active locked"></div>
                                </div>
                                <div class="cookie-option">
                                    <div class="cookie-option-info">
                                        <h4>Analytics Cookies</h4>
                                        <p>Track how you use the website</p>
                                    </div>
                                    <div class="toggle-switch" data-cookie="analytics" onclick="toggleCookie(this)">
                                    </div>
                                </div>
                                <div class="cookie-option">
                                    <div class="cookie-option-info">
                                        <h4>Advertising Cookies</h4>
                                        <p>Show personalized ads based on your browsing</p>
                                    </div>
                                    <div class="toggle-switch" data-cookie="advertising" onclick="toggleCookie(this)">
                                    </div>
                                </div>
                                <div class="cookie-option">
                                    <div class="cookie-option-info">
                                        <h4>Third-Party Cookies</h4>
                                        <p>Share data with partner companies</p>
                                    </div>
                                    <div class="toggle-switch" data-cookie="thirdparty" onclick="toggleCookie(this)">
                                    </div>
                                </div>
                            </div>
                            <div class="cookie-buttons">
                                <button class="cookie-btn accept-all" onclick="acceptAllCookies()">Accept All</button>
                                <button class="cookie-btn accept-selected" onclick="acceptSelectedCookies()">Save
                                    Choices</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Connectify App -->
                <div class="app-screen" id="app-connectify">
                    <div class="app-header" style="background: linear-gradient(135deg, #FF2D55, #FF375F);">
                        <div class="app-header-back" onclick="goHome()" style="color: white;">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title" style="color: white;">Connectify</div>
                    </div>
                    <div class="app-body" id="connectify-body">
                        <!-- Content changes based on state -->
                    </div>
                </div>

                <!-- Connectify Terms Screen -->
                <div class="app-screen terms-screen" id="app-connectify-terms">
                    <div class="app-header">
                        <div class="app-header-back" onclick="showConnectifyMain()">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title">Terms & Conditions</div>
                    </div>
                    <div class="app-body">
                        <div class="terms-content">
                            <div class="terms-section">
                                <h3>1. Data Collection</h3>
                                <div class="terms-clause">
                                    We collect basic information you provide when creating an account, including your
                                    name
                                    and email address.
                                </div>
                                <div class="terms-clause suspicious" data-discovery="data-retention"
                                    onclick="discoverClause(this)">
                                    <strong>1.2 Data Retention:</strong> We retain your data indefinitely, even after
                                    you
                                    delete your account. This includes all photos, messages, and location history you've
                                    ever shared.
                                </div>
                            </div>
                            <div class="terms-section">
                                <h3>2. Location Services</h3>
                                <div class="terms-clause">
                                    Location data helps us show you relevant content and connect you with nearby
                                    friends.
                                </div>
                                <div class="terms-clause suspicious" data-discovery="location-tracking"
                                    onclick="discoverClause(this)">
                                    <strong>2.3 Background Tracking:</strong> When you enable "Always Allow" location,
                                    we
                                    collect your location every 5 minutes, even when the app is closed, to build a
                                    complete
                                    picture of your daily movements.
                                </div>
                            </div>
                            <div class="terms-section">
                                <h3>3. Data Sharing</h3>
                                <div class="terms-clause">
                                    We may share anonymized data with partners to improve our services.
                                </div>
                                <div class="terms-clause suspicious" data-discovery="data-selling"
                                    onclick="discoverClause(this)">
                                    <strong>3.4 Third-Party Partners:</strong> We share your profile information,
                                    interests, and browsing habits with over 200 advertising partners who may contact
                                    you
                                    directly or show you targeted advertisements.
                                </div>
                            </div>
                        </div>
                        <div class="terms-buttons">
                            <button class="terms-btn agree" onclick="agreeToTerms()">I Agree</button>
                            <button class="terms-btn decline" onclick="declineTerms()">Decline</button>
                        </div>
                    </div>
                </div>

                <!-- MapMe App -->
                <div class="app-screen" id="app-mapme">
                    <div class="app-header" style="background: linear-gradient(135deg, #5856D6, #4240B0);">
                        <div class="app-header-back" onclick="goHome()" style="color: white;">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title" style="color: white;">MapMe</div>
                    </div>
                    <div class="app-body" id="mapme-body">
                        <!-- Content changes based on location permission -->
                    </div>
                </div>

                <!-- SkyWatch App -->
                <div class="app-screen" id="app-skywatch">
                    <div class="app-header" style="background: linear-gradient(135deg, #FF9500, #FF7B00);">
                        <div class="app-header-back" onclick="goHome()" style="color: white;">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title" style="color: white;">SkyWatch Weather</div>
                    </div>
                    <div class="app-body" id="skywatch-body">
                        <!-- Content changes based on location permission -->
                    </div>
                </div>

                <!-- Settings App -->
                <div class="app-screen" id="app-settings">
                    <div class="app-header">
                        <div class="app-header-back" onclick="goHome()">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title">Settings</div>
                    </div>
                    <div class="app-body" id="settings-body">
                        <div class="settings-section">
                            <div class="settings-header">Privacy & Permissions</div>
                            <div class="settings-item">
                                <div class="settings-item-icon" style="background: var(--ios-blue);">
                                    <i class="fa-solid fa-location-dot"></i>
                                </div>
                                <div class="settings-item-info">
                                    <h4>Location Services</h4>
                                    <span id="location-status-text">Not configured</span>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-icon" style="background: var(--ios-green);">
                                    <i class="fa-solid fa-camera"></i>
                                </div>
                                <div class="settings-item-info">
                                    <h4>Camera Access</h4>
                                    <span id="camera-status-text">Not configured</span>
                                </div>
                            </div>
                            <div class="settings-item">
                                <div class="settings-item-icon" style="background: var(--ios-orange);">
                                    <i class="fa-solid fa-cookie"></i>
                                </div>
                                <div class="settings-item-info">
                                    <h4>Browser Cookies</h4>
                                    <span id="cookies-status-text">Not configured</span>
                                </div>
                            </div>
                        </div>



                        <div class="settings-section">
                            <div class="settings-header">App Permissions</div>
                            <div id="app-permissions-list">
                                <div class="settings-item">
                                    <div class="settings-item-info">
                                        <span style="color: #999;">Open apps to configure permissions</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="settings-section">
                            <div class="settings-header">Reset</div>
                            <div class="settings-item" onclick="resetAllData()" style="cursor: pointer;">
                                <div class="settings-item-icon" style="background: var(--ios-red);">
                                    <i class="fa-solid fa-arrow-rotate-left"></i>
                                </div>
                                <div class="settings-item-info">
                                    <h4 style="color: var(--ios-red);">Reset All Permissions</h4>
                                    <span>Start fresh with the investigation</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- FreeGame App -->
                <div class="app-screen" id="app-freegame">
                    <div class="app-header" style="background: linear-gradient(135deg, #AF52DE, #9240C7);">
                        <div class="app-header-back" onclick="goHome()" style="color: white;">
                            <i class="fa-solid fa-chevron-left"></i> Back
                        </div>
                        <div class="app-header-title" style="color: white;">FreeGame</div>
                    </div>
                    <div class="app-body" id="freegame-body">
                        <!-- Content loads based on tracking permission -->
                    </div>
                </div>

                <!-- Permission Overlay -->
                <div class="permission-overlay" id="permission-overlay">
                    <div class="permission-dialog">
                        <div class="permission-content">
                            <div class="permission-icon" id="permission-icon"></div>
                            <div class="permission-title" id="permission-title"></div>
                            <div class="permission-description" id="permission-desc"></div>
                        </div>
                        <div class="permission-buttons" id="permission-buttons">
                            <!-- Buttons inserted dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Investigation Complete Modal -->
                <div class="complete-modal" id="complete-modal">
                    <div class="complete-content">
                        <div class="complete-icon">üéâ</div>
                        <h2>Investigation Complete!</h2>
                        <p>Great detective work! You've uncovered how apps collect and use your personal data.</p>
                        <div class="complete-stats">
                            <div class="complete-stat">
                                <div class="complete-stat-value" id="final-discoveries">0</div>
                                <div class="complete-stat-label">Discoveries</div>
                            </div>
                            <div class="complete-stat">
                                <div class="complete-stat-value" id="final-footprint">0</div>
                                <div class="complete-stat-label">Data Items</div>
                            </div>
                        </div>
                        <button class="terms-btn agree" onclick="closeCompleteModal()">Continue Exploring</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Panel -->
    <div class="info-panel">
        <div class="info-header">
            <h2><i class="fa-solid fa-circle-info"></i> Info Guide</h2>
        </div>
        <div class="info-content" id="info-content">
            <div class="info-card">
                <h4>üëã Welcome Detective!</h4>
                <p>This panel will update with helpful information as you explore different apps.</p>
            </div>
            <div class="info-card warning">
                <h4><i class="fa-solid fa-triangle-exclamation"></i> Watch Out!</h4>
                <p>Pay attention to warnings and alerts. They often contain clues about how your data is being used.</p>
            </div>
            <p style="text-align: center; color: #666; font-size: 0.85rem;">
                <i class="fa-solid fa-pen-to-square"></i> Use this information to make notes in your book!
            </p>
        </div>
    </div>

    <!-- Investigation Guide Modal -->
    <div class="instruction-modal" id="instruction-modal">
        <div class="instruction-content">
            <div class="instruction-header">
                <h2 id="instruction-title"><i class="fa-solid fa-magnifying-glass"></i> Investigation Guide</h2>
                <button class="instruction-close" onclick="closeInstructionModal()">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="instruction-body" id="instruction-body">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Sequential Alert Overlay -->
    <div class="sequential-alert-overlay" id="sequential-alert-overlay">
        <div class="alert-box" id="alert-box">
            <button class="alert-dismiss" onclick="dismissAlert()"><i class="fa-solid fa-xmark"></i></button>
            <div class="alert-icon" id="alert-icon"></div>
            <div class="alert-message" id="alert-message"></div>
            <button class="alert-btn" onclick="dismissAlert()">Got it</button>
        </div>
        } else {
        icon.classList.add('locked');
        }
        });
        }

        function openApp(appName) {
        if (!appState.unlockedApps.includes(appName)) {
        showToast('warning', 'App Locked', 'Check your Messages to unlock this app!');
        return;
        }

        // Hide home screen
        // document.getElementById('home-screen').style.display = 'none';

        // Show app screen
        document.querySelectorAll('.app-screen').forEach(screen => {
        screen.classList.remove('active');
        });
        document.getElementById(`app-${appName}`).classList.add('active');

        // Update status bar
        const statusBar = document.getElementById('status-bar');
        if (appName === 'mapme' || appName === 'skywatch' || appName === 'freegame') {
        statusBar.className = 'status-bar light';
        } else {
        statusBar.className = 'status-bar dark';
        }

        // Track visit
        if (!appState.visitedApps.includes(appName)) {
        appState.visitedApps.push(appName);
        }

        // Update info panel
        updateInfoPanel(appName);

        // Initialize app specific logic
        initializeApp(appName);
        }
        function updateInfoPanel(appName) {
        const content = document.getElementById('info-content');
        let html = '';

        switch (appName) {
        case 'browser':
        html = `
        <div class="info-card">
            <h4>üç™ Understanding Cookies</h4>
            <p>Cookies are small text files websites save on your phone. They can be useful (remembering your login) or
                invasive (tracking everything you do).</p>
        </div>
        <div class="info-card warning">
            <h4>‚ö†Ô∏è Third-Party Cookies</h4>
            <p>These are set by advertisers, not the site you're visiting. They track you across DIFFERENT websites to
                build a profile of your interests.</p>
        </div>
        <div class="info-card success">
            <h4>üõ°Ô∏è Best Practice</h4>
            <p>You can usually turn off "Advertising" and "Third-Party" cookies without breaking the website!</p>
        </div>
        `;
        break;
        case 'connectify':
        html = `
        <div class="info-card">
            <h4>üìù Terms & Conditions</h4>
            <p>These are the rules you agree to when using an app. Most people don't read them, but they often contain
                important details about your data.</p>
        </div>
        <div class="info-card warning">
            <h4>üö© Red Flags</h4>
            <p>Look out for phrases like "share with partners", "retain indefinitely", or "track background location".
            </p>
        </div>
        <div class="info-card">
            <h4>üìç Location Tracking</h4>
            <p>Some apps track you even when you're not using them! This drains battery and builds a detailed map of
                your life.</p>
        </div>
        `;
        break;
        case 'mapme':
        html = `
        <div class="info-card">
            <h4>üéØ Precise Location</h4>
            <p>Uses GPS to pinpoint your exact spot (within meters). Useful for navigation, but risky if shared with the
                wrong apps.</p>
        </div>
        <div class="info-card success">
            <h4>üåç Approximate Location</h4>
            <p>Only shows your general area (city or neighbourhood). This is enough for most apps like weather or local
                news.</p>
        </div>
        `;
        break;
        case 'skywatch':
        html = `
        <div class="info-card">
            <h4>‚òÅÔ∏è Weather Data</h4>
            <p>Weather apps need to know where you are, but they don't need your house number!</p>
        </div>
        <div class="info-card warning">
            <h4>ü§î Data Minimisation</h4>
            <p>This means only collecting the data you actually NEED. Does a weather app need your exact address? No.
            </p>
        </div>
        `;
        break;
        case 'freegame':
        html = `
        <div class="info-card warning">
            <h4>üí∏ "Free" Apps</h4>
            <p>If an app is free, YOU are often the product. They make money by selling your data to advertisers.</p>
        </div>
        <div class="info-card">
            <h4>üÜî Cross-App Tracking</h4>
            <p>This allows companies to follow you from one app to another, linking your activities to build a massive
                profile.</p>
        </div>
        `;
        break;
        default:
        html = `
        <div class="info-card">
            <h4>üëã Welcome Detective!</h4>
            <p>This panel will update with helpful information as you explore different apps.</p>
        </div>
        <div class="info-card warning">
            <h4><i class="fa-solid fa-triangle-exclamation"></i> Watch Out!</h4>
            <p>Pay attention to warnings and alerts. They often contain clues about how your data is being used.</p>
        </div>
        <p style="text-align: center; color: #666; font-size: 0.85rem;">
            <i class="fa-solid fa-pen-to-square"></i> Use this information to make notes in your book!
        </p>
        `;
        }
        content.innerHTML = html;
        }

        function initializeApp(appName) {
        switch (appName) {
        case 'browser':
        initBrowser();
        break;
        case 'connectify':
        initConnectify();
        break;
        case 'mapme':
        initMapMe();
        break;
        case 'skywatch':
        initSkyWatch();
        break;
        case 'freegame':
        initFreeGame();
        break;
        case 'settings':
        updateSettingsDisplay();
        break;
        case 'messages':
        updateMessages();
        break;
        }
        }

        // ==================== TOAST NOTIFICATIONS ====================
        // ==================== TOAST NOTIFICATIONS ====================
        function showToast(type, title, message, duration = 8000) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;

        const icons = {
        success: 'fa-circle-check',
        warning: 'fa-triangle-exclamation',
        danger: 'fa-circle-xmark',
        discovery: 'fa-magnifying-glass'
        };

        toast.innerHTML = `
        <i class="fa-solid ${icons[type]}"></i>
        <div class="toast-content">
            <strong>${title}</strong>
            <span>${message}</span>
        </div>
        `;

        container.appendChild(toast);

        setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => toast.remove(), 300);
        }, duration);
        }

        // ==================== DATA FOOTPRINT ====================
        function addToFootprint(item, icon) {
        if (!appState.footprint.find(f => f.item === item)) {
        appState.footprint.push({ item, icon });
        updateFootprintDisplay();
        showToast('danger', 'Data Collected!', `"${item}" added to your footprint`);
        }
        }

        // ==================== DISCOVERIES ====================
        function addDiscovery(id, title, description) {
        if (!appState.discoveries.find(d => d.id === id)) {
        appState.discoveries.push({ id, title, description });
        updateDiscoveriesDisplay();
        showToast('discovery', 'üîç Secret Discovered!', title, 5000);
        }
        }

        function updateDiscoveriesDisplay() {
        const container = document.getElementById('discoveries-list');

        if (appState.discoveries.length === 0) {
        container.innerHTML = `
        <p style="color: #999; font-size: 0.85rem; text-align: center; padding: 15px;">
            Investigate apps to find hidden secrets! Look for suspicious clauses highlighted in yellow.
        </p>
        `;
        } else {
        container.innerHTML = appState.discoveries.map(d => `
        <div class="discovery-item">
            <strong><i class="fa-solid fa-lightbulb"></i> ${d.title}</strong>
            <p>${d.description}</p>
        </div>
        `).join('');
        }
        }

        // ==================== MISSIONS ====================
        function completeMission(missionId) {
        if (!appState.completedMissions.includes(missionId)) {
        appState.completedMissions.push(missionId);
        updateMissionsDisplay();
        showToast('success', 'Mission Complete!', `You've completed the ${missionId} investigation`);

        // Update messages
        updateMessages();

        // Check if all missions complete
        if (appState.completedMissions.length >= 4) {
        setTimeout(() => showCompleteModal(), 1500);
        }
        }
        }

        function updateMissionsDisplay() {
        const missions = document.querySelectorAll('.mission-item');
        missions.forEach(mission => {
        const missionId = mission.dataset.mission;
        if (appState.completedMissions.includes(missionId)) {
        mission.classList.add('completed');
        mission.classList.remove('active');
        mission.querySelector('.mission-checkbox').innerHTML = '<i class="fa-solid fa-check"></i>';
        }
        });

        // Set next active mission
        const nextMission = Array.from(missions).find(m =>
        !appState.completedMissions.includes(m.dataset.mission)
        );
        if (nextMission) {
        nextMission.classList.add('active');
        }
        }

        function showCompleteModal() {
        document.getElementById('final-discoveries').textContent = appState.discoveries.length;
        document.getElementById('final-footprint').textContent = appState.footprint.length;
        document.getElementById('complete-modal').classList.add('active');
        }

        function closeCompleteModal() {
        document.getElementById('complete-modal').classList.remove('active');
        }

        // ==================== PERMISSION DIALOGS ====================
        function showPermissionDialog(config) {
        const overlay = document.getElementById('permission-overlay');
        const icon = document.getElementById('permission-icon');
        const title = document.getElementById('permission-title');
        const desc = document.getElementById('permission-desc');
        const buttons = document.getElementById('permission-buttons');

        icon.className = 'permission-icon';
        icon.style.background = config.iconBg;
        icon.innerHTML = `<i class="fa-solid ${config.icon}"></i>`;

        title.textContent = config.title;
        desc.textContent = config.description;

        buttons.innerHTML = config.buttons.map(btn => `
        <button class="permission-btn ${btn.class}" onclick='${btn.action}'>
            ${btn.text}
        </button>
        `).join('');

        overlay.classList.add('active');
        }

        function hidePermissionDialog() {
        document.getElementById('permission-overlay').classList.remove('active');
        }

        // ==================== BROWSER APP ====================
        function initBrowser() {
        if (appState.permissions.browserCookies === null) {
        // Show cookie banner
        setTimeout(() => {
        document.getElementById('cookie-banner').classList.add('active');
        }, 500);
        } else {
        updateBrowserContent();
        }
        }

        function toggleCookie(el) {
        if (!el.classList.contains('locked')) {
        el.classList.toggle('active');
        }
        }

        function acceptAllCookies() {
        // Enable all toggles
        document.querySelectorAll('.cookie-option .toggle-switch:not(.locked)').forEach(t => {
        t.classList.add('active');
        });

        appState.permissions.browserCookies = 'all';

        // Add to footprint
        addToFootprint('Browsing History', 'fa-clock-rotate-left');
        addToFootprint('Search Queries', 'fa-magnifying-glass');
        addToFootprint('Shopping Interests', 'fa-cart-shopping');
        addToFootprint('Ad Preferences', 'fa-bullhorn');

        document.getElementById('cookie-banner').classList.remove('active');
        updateBrowserContent();
        if (appState.permissions.browserCookies === 'all') {
        showSequentialAlert('‚ö†Ô∏è Alert: Ad tracking cookies installed!', 'warning');
        showSequentialAlert('‚ö†Ô∏è Warning: Location data shared with 3rd parties', 'warning');
        showSequentialAlert('‚ö†Ô∏è Caution: Browsing history synced', 'warning');
        addToFootprint('Ad Cookies', 'warning');
        addToFootprint('Location Tracker', 'danger');
        addDiscovery('cookie_all', 'Accepted all cookies (Risky)');

        // Mark mission progress
        completeMission('browser');
        }
        }

        function acceptSelectedCookies() {
        const analytics = document.querySelector('[data-cookie="analytics"]').classList.contains('active');
        const advertising = document.querySelector('[data-cookie="advertising"]').classList.contains('active');
        const thirdparty = document.querySelector('[data-cookie="thirdparty"]').classList.contains('active');

        if (analytics || advertising || thirdparty) {
        appState.permissions.browserCookies = 'some';
        if (analytics) addToFootprint('Page Views', 'fa-eye');
        if (advertising) addToFootprint('Ad Interactions', 'fa-bullhorn');
        if (thirdparty) addToFootprint('Cross-site Tracking', 'fa-share-nodes');
        } else {
        appState.permissions.browserCookies = 'necessary';
        }

        document.getElementById('cookie-banner').classList.remove('active');
        updateBrowserContent();
        if (appState.permissions.browserCookies === 'necessary') {
        showToast('‚úÖ Privacy Preserved: Only essential cookies set', 'success');
        addDiscovery('cookie_min', 'Chose necessary cookies (Safe)');

        // Mark mission progress
        completeMission('browser');
        }
        }

        function updateBrowserContent() {
        const adContainer = document.getElementById('ad-container');
        const adContent = document.getElementById('ad-content');

        if (appState.permissions.browserCookies === 'all') {
        adContainer.classList.add('personalized');
        adContent.innerHTML = `
        <p class="creepy" style="font-size: 1.1rem; margin-bottom: 10px;">
            <strong>üëã Hi there!</strong>
        </p>
        <p class="creepy">
            We noticed you searched for "birthday presents" yesterday and visited 3 gaming websites this week...
        </p>
        <p style="margin-top: 10px; font-weight: 600; color: var(--ios-red);">
            üéÆ 50% OFF Gaming Headsets - Just for YOU!
        </p>
        <p style="font-size: 0.75rem; color: #999; margin-top: 10px;">
            <i class="fa-solid fa-triangle-exclamation"></i> This ad knows your browsing history
        </p>
        `;
        } else if (appState.permissions.browserCookies === 'some') {
        adContainer.classList.remove('personalized');
        adContent.innerHTML = `
        <p style="font-size: 1.1rem;">
            <strong>üõçÔ∏è Winter Sale!</strong>
        </p>
        <p style="color: #666;">
            Check out our latest deals on electronics and more.
        </p>
        <p style="font-size: 0.75rem; color: #999; margin-top: 10px;">
            Partially personalized based on your settings
        </p>
        `;
        } else {
        adContainer.classList.remove('personalized');
        adContent.innerHTML = `
        <p style="font-size: 1.1rem;">
            <strong>üì∞ Generic Advertisement</strong>
        </p>
        <p style="color: #666;">
            Visit our store for great products!
        </p>
        <p style="font-size: 0.75rem; color: var(--ios-green); margin-top: 10px;">
            <i class="fa-solid fa-shield-halved"></i> This ad doesn't know anything about you
        </p>
        `;
        }

        // Add Change Settings Button
        adContent.innerHTML += `
        <div style="margin-top: 20px; text-align: center; border-top: 1px solid #eee; padding-top: 15px;">
            <button onclick="resetBrowserCookies()"
                style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: #666;">
                <i class="fa-solid fa-gear"></i> Change Cookie Settings
            </button>
        </div>
        `;
        }

        // ==================== CONNECTIFY APP ====================
        function initConnectify() {
        const body = document.getElementById('connectify-body');

        if (!appState.permissions.connectifyTerms) {
        // Show welcome/terms prompt
        body.innerHTML = `
        <div style="padding: 40px 20px; text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 20px;">üí¨</div>
            <h2 style="margin-bottom: 10px;">Welcome to Connectify!</h2>
            <p style="color: #666; margin-bottom: 30px;">Connect with friends, share moments, discover what's happening
                nearby.</p>

            <div
                style="background: #f8f9fa; border-radius: 15px; padding: 20px; text-align: left; margin-bottom: 20px;">
                <h4 style="margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                    <i class="fa-solid fa-file-contract"></i> Before you start...
                </h4>
                <p style="font-size: 0.9rem; color: #666;">
                    Please review our Terms & Conditions.
                    <strong style="color: var(--ios-orange);">Detective tip: Look carefully for suspicious
                        clauses!</strong>
                </p>
            </div>

            <button onclick="showConnectifyTerms()" style="
                            background: var(--ios-blue);
                            color: white;
                            border: none;
                            padding: 15px 40px;
                            border-radius: 12px;
                            font-size: 1rem;
                            font-weight: 600;
                            cursor: pointer;
                        ">
                Read Terms & Conditions
            </button>
        </div>
        `;
        } else if (appState.permissions.connectifyLocation === null) {
        // Ask for location permission
        showPermissionDialog({
        icon: 'fa-location-dot',
        iconBg: 'linear-gradient(135deg, #FF2D55, #FF375F)',
        title: '"Connectify" Would Like to Access Your Location',
        description: 'This allows us to show you friends nearby and local events.',
        buttons: [
        { text: 'Allow Always', class: 'primary', action: 'setConnectifyLocation("always")' },
        { text: 'Allow While Using', class: 'primary', action: 'setConnectifyLocation("while-using")' },
        { text: "Don't Allow", class: 'secondary', action: 'setConnectifyLocation("none")' }
        ]
        });
        renderConnectifyFeed();
        } else {
        renderConnectifyFeed();
        }
        }

        function resetBrowserCookies() {
        appState.permissions.browserCookies = null;
        document.getElementById('cookie-banner').classList.add('active');
        // Reset toggles
        document.querySelectorAll('.cookie-option .toggle-switch:not(.locked)').forEach(t => {
        t.classList.remove('active');
        });
        }

        function resetConnectify() {
        appState.permissions.connectifyTerms = false;
        appState.permissions.connectifyLocation = null;
        // Reset discoveries for this session
        document.querySelectorAll('.terms-clause.discovered').forEach(c => {
        c.classList.remove('discovered');
        });
        initConnectify();
        }

        function showConnectifyTerms() {
        document.getElementById('app-connectify-terms').classList.add('active');
        }

        function showConnectifyMain() {
        document.getElementById('app-connectify-terms').classList.remove('active');
        }

        function discoverClause(el) {
        const discoveryId = el.dataset.discovery;
        el.classList.add('discovered');

        const discoveries = {
        'data-retention': {
        title: 'Data Never Deleted!',
        description: 'Connectify keeps ALL your data forever, even after you delete your account!'
        },
        'location-tracking': {
        title: 'Background Tracking!',
        description: 'They track your location every 5 minutes, even when you\'re not using the app!'
        },
        'data-selling': {
        title: 'Data Sold to 200+ Companies!',
        description: 'Your information is shared with over 200 advertising partners!'
        }
        };

        if (discoveries[discoveryId]) {
        addDiscovery(discoveryId, discoveries[discoveryId].title, discoveries[discoveryId].description);
        }
        }

        function agreeToTerms() {
        appState.permissions.connectifyTerms = true;
        showConnectifyMain();

        // Check if user found any discoveries
        const foundAny = appState.discoveries.some(d =>
        ['data-retention', 'location-tracking', 'data-selling'].includes(d.id)
        );

        if (foundAny) {
        showToast('warning', 'Agreed to Terms', 'You agreed even after finding suspicious clauses!');
        }

        initConnectify();
        }

        function declineTerms() {
        showConnectifyMain();
        const body = document.getElementById('connectify-body');
        body.innerHTML = `
        <div style="padding: 40px 20px; text-align: center;">
            <div style="font-size: 4rem; margin-bottom: 20px;">üö´</div>
            <h2 style="margin-bottom: 10px;">Access Denied</h2>
            <p style="color: #666; margin-bottom: 20px;">
                You declined the Terms & Conditions. You cannot use Connectify without agreeing.
            </p>
            <p style="background: #e8f5e9; padding: 15px; border-radius: 12px; font-size: 0.9rem; color: #2e7d32;">
                <i class="fa-solid fa-shield-halved"></i>
                <strong>Smart choice!</strong> You protected your privacy by not agreeing to those suspicious terms.
            </p>
            <button onclick="initConnectify()" style="
                        margin-top: 20px;
                        background: #f0f0f0;
                        color: #333;
                        border: none;
                        padding: 12px 30px;
                        border-radius: 10px;
                        cursor: pointer;
                    ">
                Try Again
            </button>
        </div>
        `;

        completeMission('connectify');
        }

        function setConnectifyLocation(value) {
        hidePermissionDialog();
        appState.permissions.connectifyLocation = value;

        if (value === 'always') {
        addToFootprint('24/7 Location', 'fa-location-dot');
        addToFootprint('Movement Patterns', 'fa-route');
        addToFootprint('Places You Visit', 'fa-store');
        } else if (value === 'while-using') {
        addToFootprint('App Location', 'fa-location-dot');
        }

        renderConnectifyFeed();
        completeMission('connectify');
        }

        function renderConnectifyFeed() {
        const body = document.getElementById('connectify-body');
        const hasLocation = appState.permissions.connectifyLocation === 'always' ||
        appState.permissions.connectifyLocation === 'while-using';

        let nearbySection = '';
        if (appState.permissions.connectifyLocation === 'always') {
        nearbySection = `
        <div class="nearby-feature">
            <h3><i class="fa-solid fa-location-dot"></i> People Nearby</h3>
            <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                Based on your <strong style="color: var(--ios-red);">always-on</strong> location
            </p>
            <div class="nearby-list">
                <div class="nearby-item">
                    <div class="social-avatar" style="width: 35px; height: 35px; font-size: 0.8rem;">AS</div>
                    <div style="flex: 1;">
                        <strong style="font-size: 0.9rem;">Alex Smith</strong>
                        <p style="font-size: 0.75rem; color: #666;">Last seen at Costa Coffee</p>
                    </div>
                    <span class="distance">0.3 km</span>
                </div>
                <div class="nearby-item">
                    <div class="social-avatar"
                        style="width: 35px; height: 35px; font-size: 0.8rem; background: linear-gradient(135deg, #f093fb, #f5576c);">
                        JD</div>
                    <div style="flex: 1;">
                        <strong style="font-size: 0.9rem;">Jamie Davis</strong>
                        <p style="font-size: 0.75rem; color: #666;">Currently at the Library</p>
                    </div>
                    <span class="distance">0.5 km</span>
                </div>
            </div>
            <p style="font-size: 0.75rem; color: var(--ios-red); margin-top: 15px;">
                <i class="fa-solid fa-triangle-exclamation"></i>
                Others can see YOUR location too!
            </p>
        </div>
        `;
        } else if (appState.permissions.connectifyLocation === 'while-using') {
        nearbySection = `
        <div class="nearby-feature" style="background: #e3f2fd; border-color: var(--ios-blue);">
            <h3><i class="fa-solid fa-location-dot" style="color: var(--ios-blue);"></i> People Nearby</h3>
            <p style="font-size: 0.85rem; color: #666;">
                Location shared <strong style="color: var(--ios-blue);">only while using app</strong>
            </p>
            <p style="font-size: 0.8rem; color: var(--ios-green); margin-top: 10px;">
                <i class="fa-solid fa-shield-halved"></i> Good choice! Location stops when you close the app.
            </p>
        </div>
        `;
        } else {
        nearbySection = `
        <div class="nearby-feature disabled">
            <h3><i class="fa-solid fa-location-slash"></i> People Nearby</h3>
            <p style="font-size: 0.85rem; color: #666;">
                Enable location to see friends nearby
            </p>
            <p style="font-size: 0.8rem; color: var(--ios-green); margin-top: 10px;">
                <i class="fa-solid fa-shield-halved"></i> Your location is private!
            </p>
        </div>
        `;
        }

        body.innerHTML = `
        <div class="social-feed">
            ${nearbySection}

            <div class="social-post">
                <div class="social-post-header">
                    <div class="social-avatar">TJ</div>
                    <div class="social-user-info">
                        <h4>Taylor Jones</h4>
                        <span>2 hours ago</span>
                    </div>
                </div>
                <p style="font-size: 0.95rem;">Just finished my homework! üìö Time for some gaming üéÆ</p>
            </div>

            <div class="social-post">
                <div class="social-post-header">
                    <div class="social-avatar" style="background: linear-gradient(135deg, #11998e, #38ef7d);">MK</div>
                    <div class="social-user-info">
                        <h4>Morgan Kelly</h4>
                        <span>5 hours ago</span>
                    </div>
                </div>
                <p style="font-size: 0.95rem;">Beautiful sunset at the beach today! üåÖ</p>
            </div>
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="resetConnectify()"
                style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: #666;">
                <i class="fa-solid fa-rotate-left"></i> Reset Connectify
            </button>
        </div>
        `;
        }

        // ==================== MAPME APP ====================
        function initMapMe() {
        if (appState.permissions.mapmeLocation === null) {
        showPermissionDialog({
        icon: 'fa-map-location-dot',
        iconBg: 'linear-gradient(135deg, #5856D6, #4240B0)',
        title: '"MapMe" Would Like to Access Your Location',
        description: 'Your location is used to show maps and provide directions.',
        buttons: [
        { text: 'Precise Location', class: 'primary', action: 'setMapMeLocation("precise")' },
        { text: 'Approximate Location', class: 'primary', action: 'setMapMeLocation("approximate")' },
        { text: "Don't Allow", class: 'secondary', action: 'setMapMeLocation("none")' }
        ]
        });
        }
        renderMapMe();
        }

        function setMapMeLocation(value) {
        hidePermissionDialog();
        appState.permissions.mapmeLocation = value;

        if (value === 'precise') {
        addToFootprint('Exact Address', 'fa-house');
        addToFootprint('GPS Coordinates', 'fa-satellite');
        showToast('danger', 'Precise Location Shared', 'MapMe now knows your exact location within 3 meters!');
        } else if (value === 'approximate') {
        addToFootprint('General Area', 'fa-map');
        showToast('success', 'Privacy Protected', 'MapMe only knows your general area (1-2 km radius)');
        }

        renderMapMe();
        completeMission('mapme');
        }

        function renderMapMe() {
        const body = document.getElementById('mapme-body');
        const loc = appState.permissions.mapmeLocation;

        let mapContent = '';
        let statusContent = '';

        if (loc === 'precise') {
        mapContent = `
        <div class="map-grid"></div>
        <div class="map-marker precise" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <i class="fa-solid fa-location-dot"></i>
        </div>
        `;
        statusContent = `
        <div class="location-status precise">
            <i class="fa-solid fa-location-crosshairs"></i>
            <div>
                <strong>Precise Location Active</strong>
                <p style="font-size: 0.8rem; color: #666;">123 Oak Street, London (within 3m)</p>
            </div>
        </div>
        <p style="font-size: 0.85rem; color: var(--ios-red); background: #fff5f5; padding: 12px; border-radius: 10px;">
            <i class="fa-solid fa-triangle-exclamation"></i>
            <strong>Privacy Warning:</strong> The app knows your exact address and can track your precise movements!
        </p>
        `;
        } else if (loc === 'approximate') {
        mapContent = `
        <div class="map-grid"></div>
        <div class="map-radius approximate"></div>
        <div class="map-marker approximate" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">
            <i class="fa-solid fa-circle-dot"></i>
        </div>
        `;
        statusContent = `
        <div class="location-status approximate">
            <i class="fa-solid fa-circle-dot"></i>
            <div>
                <strong>Approximate Location</strong>
                <p style="font-size: 0.8rem; color: #666;">North London Area (within 1-2km)</p>
            </div>
        </div>
        <p
            style="font-size: 0.85rem; color: var(--ios-green); background: #e8f5e9; padding: 12px; border-radius: 10px;">
            <i class="fa-solid fa-shield-halved"></i>
            <strong>Good choice!</strong> Maps still work, but they don't know your exact address.
        </p>
        `;
        } else {
        mapContent = `
        <div class="map-grid"></div>
        <div style="text-align: center; color: #666;">
            <i class="fa-solid fa-location-slash" style="font-size: 3rem; margin-bottom: 10px;"></i>
            <p>Location disabled</p>
        </div>
        `;
        statusContent = `
        <div class="location-status denied">
            <i class="fa-solid fa-location-slash"></i>
            <div>
                <strong>Location Disabled</strong>
                <p style="font-size: 0.8rem; color: #666;">You can still search for places manually</p>
            </div>
        </div>
        <p
            style="font-size: 0.85rem; color: var(--ios-green); background: #e8f5e9; padding: 12px; border-radius: 10px;">
            <i class="fa-solid fa-shield-halved"></i>
            <strong>Maximum Privacy!</strong> The app has no location data about you.
        </p>
        `;
        }

        body.innerHTML = `
        <div class="map-container">
            ${mapContent}
        </div>
        <div class="map-info">
            ${statusContent}
            <div style="margin-top: 15px; padding: 12px; background: #f8f9fa; border-radius: 10px;">
                <strong style="font-size: 0.85rem;">ü§î Think About It:</strong>
                <p style="font-size: 0.8rem; color: #666; margin-top: 5px;">
                    Does a map app really need to know your exact address, or is "somewhere in London" good enough for
                    most things?
                </p>
            </div>
        </div>
        <div style="margin-top: 15px; text-align: center;">
            <button onclick="appState.permissions.mapmeLocation = null; initMapMe();"
                style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: #666;">
                <i class="fa-solid fa-gear"></i> Change Location Settings
            </button>
        </div>
        `;
        }

        // ==================== SKYWATCH APP ====================
        function initSkyWatch() {
        if (appState.permissions.skywatchLocation === null) {
        showPermissionDialog({
        icon: 'fa-cloud-sun',
        iconBg: 'linear-gradient(135deg, #FF9500, #FF7B00)',
        title: '"SkyWatch" Would Like to Access Your Location',
        description: 'To show weather for your area.',
        buttons: [
        { text: 'Precise Location', class: 'primary', action: 'setSkyWatchLocation("precise")' },
        { text: 'Approximate Location', class: 'primary', action: 'setSkyWatchLocation("approximate")' },
        { text: "Don't Allow", class: 'secondary', action: 'setSkyWatchLocation("none")' }
        ]
        });
        }
        renderSkyWatch();
        }

        function setSkyWatchLocation(value) {
        hidePermissionDialog();
        appState.permissions.skywatchLocation = value;

        if (value === 'precise') {
        addToFootprint('Home Location', 'fa-house');
        showToast('warning', 'Precise Location for Weather?', 'Does weather really change from house to house?');
        } else if (value === 'approximate') {
        showToast('success', 'Smart Choice!', 'Weather is the same across your area anyway!');
        }

        renderSkyWatch();
        completeMission('skywatch');
        }

        function renderSkyWatch() {
        const body = document.getElementById('skywatch-body');
        const loc = appState.permissions.skywatchLocation;

        let locationText = '';
        let locationClass = '';
        let privacyNote = '';

        if (loc === 'precise') {
        locationText = '123 Oak Street, London';
        locationClass = 'precise';
        privacyNote = `
        <div style="background: #fff5f5; padding: 15px; margin: 20px; border-radius: 12px; text-align: center;">
            <p style="color: var(--ios-red); font-size: 0.85rem;">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <strong>Overkill!</strong> The weather is exactly the same as your neighbour's.
                They didn't need your exact address!
            </p>
        </div>
        `;
        } else if (loc === 'approximate') {
        locationText = 'North London';
        locationClass = 'vague';
        privacyNote = `
        <div style="background: #e8f5e9; padding: 15px; margin: 20px; border-radius: 12px; text-align: center;">
            <p style="color: var(--ios-green); font-size: 0.85rem;">
                <i class="fa-solid fa-shield-halved"></i>
                <strong>Perfect!</strong> You get accurate weather without revealing your address.
                Weather doesn't change street by street!
            </p>
        </div>
        `;
        } else {
        locationText = 'Location unavailable';
        locationClass = '';
        privacyNote = `
        <div style="background: #f8f9fa; padding: 15px; margin: 20px; border-radius: 12px; text-align: center;">
            <p style="color: #666; font-size: 0.85rem;">
                <i class="fa-solid fa-info-circle"></i>
                You can still search for weather in any city manually!
            </p>
        </div>
        `;
        }

        body.innerHTML = `
        <div class="weather-container" style="background: linear-gradient(180deg, #87CEEB, #E0F6FF);">
            <div class="weather-icon">‚õÖ</div>
            <div class="weather-temp">14¬∞</div>
            <div class="weather-location ${locationClass}">${locationText}</div>
            <div class="weather-details">
                <div class="weather-detail">
                    <i class="fa-solid fa-droplet"></i>
                    <span>62%</span>
                </div>
                <div class="weather-detail">
                    <i class="fa-solid fa-wind"></i>
                    <span>12 km/h</span>
                </div>
                <div class="weather-detail">
                    <i class="fa-solid fa-eye"></i>
                    <span>10 km</span>
                </div>
            </div>
        </div>
        ${privacyNote}
        <div style="padding: 0 20px;">
            <h4 style="margin-bottom: 10px;">This Week</h4>
            <div
                style="display: flex; justify-content: space-between; background: white; padding: 15px; border-radius: 12px;">
                <div style="text-align: center;">
                    <div>Mon</div>
                    <div>‚õÖ</div>
                    <div>14¬∞</div>
                </div>
                <div style="text-align: center;">
                    <div>Tue</div>
                    <div>üåßÔ∏è</div>
                    <div>11¬∞</div>
                </div>
                <div style="text-align: center;">
                    <div>Wed</div>
                    <div>‚òÅÔ∏è</div>
                    <div>12¬∞</div>
                </div>
                <div style="text-align: center;">
                    <div>Thu</div>
                    <div>‚õÖ</div>
                    <div>13¬∞</div>
                </div>
                <div style="text-align: center;">
                    <div>Fri</div>
                    <div>‚òÄÔ∏è</div>
                    <div>15¬∞</div>
                </div>
            </div>
        </div>
        `;

        // Add Change Settings Button
        if (loc !== null) {
        body.innerHTML += `
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="appState.permissions.skywatchLocation = null; initSkyWatch();"
                style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: #666;">
                <i class="fa-solid fa-gear"></i> Change Location Settings
            </button>
        </div>
        `;
        }
        }

        // ==================== FREEGAME APP ====================
        function initFreeGame() {
        if (appState.permissions.freegameTracking === null) {
        showPermissionDialog({
        icon: 'fa-chart-line',
        iconBg: 'linear-gradient(135deg, #AF52DE, #9240C7)',
        title: '"FreeGame" Would Like Permission to Track You',
        description: 'This allows us to deliver personalized ads and measure ad effectiveness across apps and websites
        owned by other companies.',
        buttons: [
        { text: 'Allow Tracking', class: 'danger', action: 'setFreeGameTracking(true)' },
        { text: 'Ask App Not to Track', class: 'primary', action: 'setFreeGameTracking(false)' }
        ]
        });
        }
        renderFreeGame();
        }

        function setFreeGameTracking(allowed) {
        hidePermissionDialog();
        appState.permissions.freegameTracking = allowed;

        if (allowed) {
        addToFootprint('App Usage', 'fa-mobile');
        addToFootprint('Gaming Habits', 'fa-gamepad');
        addToFootprint('Cross-App Tracking', 'fa-share-nodes');
        showToast('danger', 'Tracking Enabled', 'FreeGame can now follow you across other apps!');
        } else {
        showToast('success', 'Tracking Blocked', 'FreeGame cannot track you across other apps');
        }

        renderFreeGame();
        }

        function renderFreeGame() {
        const body = document.getElementById('freegame-body');
        const tracking = appState.permissions.freegameTracking;

        let content = `
        <div class="game-container">
            <div class="game-preview">
                <h2>üöÄ Space Blaster</h2>
                <p>The #1 FREE space shooter!</p>
            </div>
            `;

            if (tracking === true) {
            content += `
            <div
                style="background: #fff5f5; border: 2px solid var(--ios-red); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: var(--ios-red); margin-bottom: 10px;">
                    <i class="fa-solid fa-ad"></i> Personalized Ads
                </h4>
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                    Based on your activity across apps:
                </p>
                <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <p style="font-size: 0.9rem;"><strong>üéÆ Gaming Chair - ¬£199</strong></p>
                    <p style="font-size: 0.75rem; color: #999;">You played games for 3 hours this week</p>
                </div>
                <div style="background: white; padding: 15px; border-radius: 10px;">
                    <p style="font-size: 0.9rem;"><strong>üçï Pizza Hut Nearby</strong></p>
                    <p style="font-size: 0.75rem; color: #999;">Based on your location history</p>
                </div>
            </div>
            <p style="font-size: 0.8rem; color: var(--ios-red); text-align: center;">
                <i class="fa-solid fa-triangle-exclamation"></i>
                This "free" game is paid for by selling your data!
            </p>
            `;
            } else if (tracking === false) {
            content += `
            <div
                style="background: #e8f5e9; border: 2px solid var(--ios-green); border-radius: 15px; padding: 20px; margin-bottom: 20px;">
                <h4 style="color: var(--ios-green); margin-bottom: 10px;">
                    <i class="fa-solid fa-shield-halved"></i> Generic Ads Only
                </h4>
                <p style="font-size: 0.85rem; color: #666; margin-bottom: 15px;">
                    You'll still see ads, but they won't be based on tracking you:
                </p>
                <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px;">
                    <p style="font-size: 0.9rem;"><strong>üì± New Phone Deals</strong></p>
                    <p style="font-size: 0.75rem; color: #999;">Generic advertisement</p>
                </div>
            </div>
            <p style="font-size: 0.8rem; color: var(--ios-green); text-align: center;">
                <i class="fa-solid fa-circle-check"></i>
                The game still works! You just see random ads instead of creepy targeted ones.
            </p>
            `;
            } else {
            content += `
            <div class="game-blocked">
                <i class="fa-solid fa-lock"></i>
                <h3>Permission Required</h3>
                <p>Grant or deny tracking permission to continue</p>
            </div>
            `;
            }

            content += '
        </div>';

        if (tracking !== null) {
        content += `
        <div style="margin-top: 20px; text-align: center;">
            <button onclick="appState.permissions.freegameTracking = null; initFreeGame();"
                style="background: #f0f0f0; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; color: #666;">
                <i class="fa-solid fa-gear"></i> Change Tracking Settings
            </button>
        </div>
        `;
        }

        body.innerHTML = content;
        }

        // ==================== SETTINGS ====================
        function updateSettingsDisplay() {
        const locText = document.getElementById('location-status-text');
        const cookieText = document.getElementById('cookies-status-text');

        // Location status
        const locApps = [];
        if (appState.permissions.mapmeLocation) locApps.push('MapMe');
        if (appState.permissions.skywatchLocation) locApps.push('SkyWatch');
        if (appState.permissions.connectifyLocation) locApps.push('Connectify');

        locText.textContent = locApps.length > 0 ? `${locApps.length} apps have access` : 'No apps have access';

        // Cookies status
        if (appState.permissions.browserCookies === 'all') {
        cookieText.textContent = 'All cookies accepted';
        } else if (appState.permissions.browserCookies === 'necessary') {
        cookieText.textContent = 'Necessary only';
        } else if (appState.permissions.browserCookies === 'some') {
        cookieText.textContent = 'Some cookies accepted';
        } else {
        cookieText.textContent = 'Not configured';
        }
        }

        function resetAllData() {
        if (confirm('Reset all permissions and start fresh?')) {
        // Reset state
        appState.permissions = {
        browserCookies: null,
        connectifyLocation: null,
        connectifyTerms: false,
        connectifyPhotos: null,
        mapmeLocation: null,
        skywatchLocation: null,
        freegameTracking: null
        };
        appState.footprint = [];
        appState.discoveries = [];
        appState.completedMissions = [];
        appState.visitedApps = [];
        appState.unlockedApps = ['messages', 'settings']; // Reset locked state

        // Reset displays
        updateFootprintDisplay();
        updateDiscoveriesDisplay();
        document.querySelectorAll('.mission-item').forEach(m => {
        m.classList.remove('completed', 'active');
        m.querySelector('.mission-checkbox').innerHTML = '';
        });
        document.querySelector('.mission-item').classList.add('active');
        updateHomeIcons(); // Update icons

        // Reset terms clauses
        document.querySelectorAll('.terms-clause.discovered').forEach(c => {
        c.classList.remove('discovered');
        });

        // Reset cookie banner
        document.getElementById('cookie-banner').classList.remove('active');
        document.querySelectorAll('.cookie-option .toggle-switch:not(.locked)').forEach(t => {
        t.classList.remove('active');
        });

        showToast('success', 'Reset Complete', 'All permissions cleared. Start fresh!');
        goHome();
        }
        }

        // ==================== MESSAGES ====================
        function updateMessages() {
        const container = document.getElementById('messages-content');

        // Clear badge when viewing
        const badge = document.getElementById('messages-badge');
        badge.style.display = 'none';

        // Add new messages based on completed missions
        let newMessages = '';
        let msgCount = 0;

        // Initial Message (Always present)
        if (!container.querySelector('[data-msg="welcome"]')) {
        newMessages += `
        <div data-msg="welcome">
            <div class="message-bubble message-received">
                üëã Welcome Agent! Your first mission is ready.
            </div>
            <div class="message-mission">
                <h4><i class="fa-solid fa-bullseye"></i> Mission 1: Browser</h4>
                <p>We need to investigate how cookies affect what we see online.</p>
                <ul>
                    <li>Open the <strong>Browser</strong> app</li>
                    <li>Accept "All Cookies" and watch the ad</li>
                    <li>Then change settings to "Necessary Only"</li>
                </ul>
                <button onclick="unlockApp('browser')" class="terms-btn agree" style="width: 100%; margin-top: 10px;">
                    <i class="fa-solid fa-unlock"></i> Unlock Browser App
                </button>
            </div>
        </div>
        `;
        msgCount++;
        }

        if (appState.completedMissions.includes('browser') && !container.querySelector('[data-msg="browser-done"]')) {
        newMessages += `
        <div data-msg="browser-done">
            <div class="message-bubble message-sent">I investigated the cookies!</div>
            <div class="message-bubble message-received">
                Excellent work! üéâ Did you see how the ad changed based on your cookie choice?
            </div>
            <div class="message-mission">
                <h4><i class="fa-solid fa-bullseye"></i> Next Mission: Connectify</h4>
                <p>Open <strong>Connectify</strong> and read the Terms & Conditions carefully.</p>
                <ul>
                    <li>Look for <span style="background: #FFF3CD; padding: 2px 6px; border-radius: 4px;">yellow
                            highlighted</span> clauses</li>
                    <li>Click on them to investigate!</li>
                    <li>How long do they keep your data?</li>
                </ul>
            </div>
            <div class="message-bubble message-received">
                <i class="fa-solid fa-unlock"></i> <strong>Connectify</strong> app unlocked!
            </div>
        </div>
        `;
        msgCount++;
        if (!appState.unlockedApps.includes('connectify')) {
        appState.unlockedApps.push('connectify');
        updateHomeIcons();
        showToast('success', 'App Unlocked', 'Connectify is now available');
        }
        }

        if (appState.completedMissions.includes('connectify') &&
        !container.querySelector('[data-msg="connectify-done"]')) {
        newMessages += `
        <div data-msg="connectify-done">
            <div class="message-bubble message-sent">I found suspicious clauses in the Terms!</div>
            <div class="message-bubble message-received">
                You found ${appState.discoveries.length} hidden secrets! Most people just click "Agree" without reading.
                Not you! üïµÔ∏è
            </div>
            <div class="message-mission">
                <h4><i class="fa-solid fa-bullseye"></i> Next Mission: MapMe</h4>
                <p>Compare <strong>Precise</strong> vs <strong>Approximate</strong> location:</p>
                <ul>
                    <li>Try precise first - what exactly does it know?</li>
                    <li>Then go to Settings ‚Üí Reset and try approximate</li>
                    <li>Does the map still work? What's the difference?</li>
                </ul>
            </div>
            <div class="message-bubble message-received">
                <i class="fa-solid fa-unlock"></i> <strong>MapMe</strong> app unlocked!
            </div>
        </div>
        `;
        msgCount++;
        if (!appState.unlockedApps.includes('mapme')) {
        appState.unlockedApps.push('mapme');
        updateHomeIcons();
        showToast('success', 'App Unlocked', 'MapMe is now available');
        }
        }

        if (appState.completedMissions.includes('mapme') && !container.querySelector('[data-msg="mapme-done"]')) {
        newMessages += `
        <div data-msg="mapme-done">
            <div class="message-bubble message-sent">The map works fine with approximate location!</div>
            <div class="message-bubble message-received">
                Exactly! üí° Apps often ask for more data than they actually need. Approximate location is usually
                enough!
            </div>
            <div class="message-mission">
                <h4><i class="fa-solid fa-bullseye"></i> Final Mission: SkyWatch</h4>
                <p>Test if weather really needs your <strong>exact</strong> location:</p>
                <ul>
                    <li>Does the weather change from house to house? ü§î</li>
                    <li>What happens with approximate location?</li>
                </ul>
            </div>
            <div class="message-bubble message-received">
                <i class="fa-solid fa-unlock"></i> <strong>SkyWatch</strong> app unlocked!
            </div>
        </div>
        `;
        msgCount++;
        if (!appState.unlockedApps.includes('skywatch')) {
        appState.unlockedApps.push('skywatch');
        updateHomeIcons();
        showToast('success', 'App Unlocked', 'SkyWatch is now available');
        }
        }

        if (appState.completedMissions.includes('skywatch') && !container.querySelector('[data-msg="skywatch-done"]')) {
        newMessages += `
        <div data-msg="skywatch-done">
            <div class="message-bubble message-sent">Weather doesn't need my exact address!</div>
            <div class="message-bubble message-received">
                üéâ <strong>INVESTIGATION COMPLETE!</strong>
            </div>
            <div class="message-bubble message-received">
                You've learned that many apps ask for more data than they need. Always ask yourself: "Why does this app
                need THIS information?"
            </div>
            <div
                style="background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 15px; padding: 20px; margin: 15px 0; text-align: center;">
                <h4 style="color: #2e7d32; margin-bottom: 10px;">üèÜ Detective Summary</h4>
                <p style="font-size: 0.9rem; margin-bottom: 10px;">
                    <strong>Data items shared:</strong> ${appState.footprint.length}<br>
                    <strong>Hidden clauses found:</strong> ${appState.discoveries.length}
                </p>
                <p style="font-size: 0.85rem; color: #666;">
                    Fill in your Investigation Log in your exercise book!
                </p>
            </div>
            <div class="message-bubble message-received">
                <i class="fa-solid fa-unlock"></i> Bonus Level: <strong>FreeGame</strong> unlocked!
            </div>
            <div class="message-mission">
                <h4><i class="fa-solid fa-gamepad"></i> Bonus Mission</h4>
                <p>Check out "FreeGame" to see the cost of free apps.</p>
            </div>
        </div>
        `;
        msgCount++;
        if (!appState.unlockedApps.includes('freegame')) {
        appState.unlockedApps.push('freegame');
        updateHomeIcons();
        showToast('success', 'App Unlocked', 'FreeGame is now available');
        }
        }

        container.innerHTML += newMessages;

        if (msgCount > 0) {
        const badge = document.getElementById('messages-badge');
        badge.style.display = 'flex';
        badge.textContent = msgCount;
        showToast('success', 'New Message', 'You have new instructions!');
        }

        // Scroll to bottom
        const appBody = container.parentElement;
        appBody.scrollTop = appBody.scrollHeight;
        }

        function unlockApp(appName) {
        if (!appState.unlockedApps.includes(appName)) {
        appState.unlockedApps.push(appName);
        updateHomeIcons();
        showToast('success', 'App Unlocked', `${appName.charAt(0).toUpperCase() + appName.slice(1)} is now available`);
        // Find the button and disable it
        const btn = event.target.closest('button');
        if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-check"></i> Unlocked';
        btn.classList.remove('agree');
        btn.style.opacity = '0.7';
        }
        }
        }

        // ==================== INSTRUCTION MODALS ====================
        const missionInstructions = {
        browser: `
        <h3>üéØ Mission Objective</h3>
        <p>Investigate how cookies track your behavior and influence what you see online.</p>

        <div class="notebook-task">
            <h4><i class="fa-solid fa-pencil"></i> Detective Task: The Cookie Analysis</h4>
            <p>In your Exercise Book, draw a table with these headings:</p>
            <table class="instruction-table">
                <tr>
                    <th>Setting Chosen</th>
                    <th>Ad Shown</th>
                    <th>What data was shared?</th>
                    <th>Benefit vs Trade-off</th>
                </tr>
            </table>
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Test <strong>"Accept All Cookies"</strong> and fill in the first row. What ad do you see? Why?</li>
                <li>Reset and test <strong>"Necessary Only"</strong> and fill in the second row.</li>
            </ol>
            <p><strong>Reflection:</strong> Why do you think websites make the "Accept All" button so much brighter and
                bigger than the "Reject" button?</p>
        </div>
        `,
        connectify: `
        <h3>üéØ Mission Objective</h3>
        <p>Analyze Terms & Conditions to find hidden clauses that compromise your privacy.</p>

        <div class="notebook-task">
            <h4><i class="fa-solid fa-pencil"></i> Detective Task: Terms Translator</h4>
            <p>Companies use complicated legal language ("Legalese") to hide things. Your job is to translate it.</p>
            <p><strong>Create this table in your Exercise Book:</strong></p>
            <table class="instruction-table">
                <tr>
                    <th>The Clause (What they say)</th>
                    <th>The Translation (What they mean)</th>
                    <th>Risk Rating (1-5)</th>
                </tr>
            </table>
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Find the <strong>3 yellow highlighted clauses</strong> in the app.</li>
                <li>Copy the key phrase into the first column.</li>
                <li>Write what it <em>actually</em> means for your privacy in the second column.</li>
                <li>Give it a risk rating (5 = Very Dangerous).</li>
            </ol>
            <p><strong>Critical Thinking:</strong> If you knew this app kept your photos forever, would you still post a
                selfie? Explain why/why not.</p>
        </div>
        `,
        mapme: `
        <h3>üéØ Mission Objective</h3>
        <p>Understand the difference between Precise and Approximate location and when to use each.</p>

        <div class="notebook-task">
            <h4><i class="fa-solid fa-pencil"></i> Detective Task: Location Risk Assessment</h4>
            <p>Not all location data is the same. Compare the two modes in your book.</p>
            <p><strong>Draw this comparison table:</strong></p>
            <table class="instruction-table">
                <tr>
                    <th>Mode</th>
                    <th>What the app sees</th>
                    <th>Useful for...</th>
                    <th>Dangerous because...</th>
                </tr>
            </table>
            <p><strong>Instructions:</strong></p>
            <ol>
                <li>Test <strong>"Precise"</strong> and <strong>"Approximate"</strong> modes in the app.</li>
                <li>Fill in the table based on your observations.</li>
            </ol>
            <p><strong>Scenario Challenge:</strong></p>
            <ul>
                <li>If you were using a <strong>SatNav</strong> to drive, which mode do you need?</li>
                <li>If you were using a <strong>Local News</strong> app, which mode is safer?</li>
            </ul>
        </div>
        `,
        skywatch: `
        <h3>üéØ Mission Objective</h3>
        <p>Determine if an app is asking for excessive permissions (Data Minimization principle).</p>

        <div class="notebook-task">
            <h4><i class="fa-solid fa-pencil"></i> Detective Task: The Permission Audit</h4>
            <p>Does this app really need all this data? Apply the "Data Minimization" principle.</p>
            <p><strong>Copy and complete this audit in your book:</strong></p>
            <table class="instruction-table">
                <tr>
                    <th>Permission Requested</th>
                    <th>Is it needed for Weather?</th>
                    <th>Why do they really want it?</th>
                </tr>
                <tr>
                    <td>Precise Location</td>
                    <td>[Yes/No]</td>
                    <td>[Your Theory]</td>
                </tr>
                <tr>
                    <td>Contacts / Photos</td>
                    <td>[Yes/No]</td>
                    <td>[Your Theory]</td>
                </tr>
            </table>
            <p><strong>Your Rule:</strong> Write a personal rule for yourself: <em>"I will only grant Precise Location
                    if..."</em></p>
        </div>
        `,
        freegame: `
        <h3>üéØ Mission Objective</h3>
        <p>Uncover the hidden cost of "Free" applications.</p>

        <div class="notebook-task">
            <h4><i class="fa-solid fa-pencil"></i> Detective Task: The Data Balance Sheet</h4>
            <p>If the product is free, <strong>YOU</strong> are the product.</p>
            <p><strong>Create a "Data Balance Sheet" in your book:</strong></p>
            <table class="instruction-table">
                <tr>
                    <th>What I Get (Benefits)</th>
                    <th>What I Pay (Data Cost)</th>
                </tr>
                <tr>
                    <td>e.g., Fun gameplay</td>
                    <td>e.g., My location history</td>
                </tr>
                <tr>
                    <td>e.g., High score tables</td>
                    <td>e.g., Targeted ads</td>
                </tr>
            </table>
            <p><strong>Final Verdict:</strong> Look at your balance sheet. Is the game worth the cost? Write a paragraph
                explaining your decision.</p>
        </div>
        `
        };

        function openInstructionModal(missionId) {
        const modal = document.getElementById('instruction-modal');
        const content = document.getElementById('instruction-body');
        const title = document.getElementById('instruction-title');

        // Set content
        if (missionInstructions[missionId]) {
        content.innerHTML = missionInstructions[missionId];
        // Update title based on mission name
        const missionName = document.querySelector(`.mission-item[data-mission="${missionId}"] strong`).textContent;
        title.innerHTML = `<i class="fa-solid fa-magnifying-glass"></i> Guide: ${missionName}`;

        modal.classList.add('active');

        // Scroll to top
        content.scrollTop = 0;
        }
        }



        /* Guide Panel (formerly Instruction Modal) */
        function closeInstructionModal() {
        document.getElementById('instruction-modal').classList.remove('active');
        }

        // Close modal on outside click or Escape key
        document.getElementById('instruction-modal').addEventListener('click', (e) => {
        if (e.target.id === 'instruction-modal') {
        closeInstructionModal();
        }
        });

        document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
        closeInstructionModal();
        }
        });


        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', () => {
        // App icon click handlers
        document.querySelectorAll('.app-icon').forEach(icon => {
        icon.addEventListener('click', () => {
        const appName = icon.dataset.app;
        openApp(appName);
        });
        });

        // Update time
        function updateTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const mins = now.getMinutes().toString().padStart(2, '0');
        document.querySelectorAll('.status-time').forEach(el => {
        el.textContent = `${hours}:${mins}`;
        });
        document.querySelector('.home-wallpaper-text .time').textContent = `${hours}:${mins}`;
        }
        updateTime();
        setInterval(updateTime, 1000);

        // Initialize displays
        updateFootprintDisplay();
        updateDiscoveriesDisplay();
        updateMissionsDisplay();
        updateHomeIcons(); // Initialize locked icons
        });
        </script>
</body>

</html>