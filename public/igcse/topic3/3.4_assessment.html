<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3.4 Network Hardware Assessment | St George's CS</title>
    <!-- version: retryable-assessment v4 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        :root {
            --sg-blue: #003366;
            --sg-gold: #D4AF37;
            --sg-text: #333333;
            --sg-light-blue: #e6f0fa;
            --sg-grey: #f4f6f8;
            --correct-green: #28a745;
            --wrong-red: #dc3545;
            --paired-amber: #f0ad4e;
            --reflection-green: #28a745;
            --teacher-purple: #6f42c1;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--sg-text);
            background-color: #ffffff;
            line-height: 1.6;
            padding-bottom: 100px;
        }

        /* Start Modal */
        #startOverlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 51, 102, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        #startCard {
            background: white;
            padding: 40px;
            border-radius: 16px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            border-top: 6px solid var(--sg-gold);
        }

        #startCard h2 {
            color: var(--sg-blue);
            margin-bottom: 8px;
            font-size: 1.8rem;
        }

        #startCard .test-name {
            color: var(--sg-gold);
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
        }

        #startCard .instructions {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }

        #startCard label {
            font-size: 0.9rem;
            color: #555;
            display: block;
            text-align: left;
            margin-bottom: 6px;
            font-weight: 600;
        }

        #startCard select {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            background: white;
        }

        #startCard select:focus {
            border-color: var(--sg-blue);
            outline: none;
        }

        #startCard button {
            width: 100%;
            padding: 14px;
            background: var(--sg-blue);
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        #startCard button:hover {
            background: var(--sg-gold);
            transform: translateY(-2px);
        }

        /* Timer Display */
        #timerDisplay {
            position: fixed;
            top: 18px;
            right: 100px;
            color: var(--sg-blue);
            font-size: 1rem;
            font-weight: 600;
            z-index: 900;
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            border: 2px solid var(--sg-blue);
        }

        /* Header */
        header {
            background: white;
            padding: 1.5rem;
            border-bottom: 4px solid var(--sg-gold);
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        h1 {
            color: var(--sg-blue);
            margin-bottom: 0.5rem;
        }

        p.subtitle {
            color: #666;
            font-size: 0.9rem;
        }

        /* Main Content */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .question-block {
            background: var(--sg-grey);
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 40px;
            border-left: 5px solid var(--sg-blue);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .q-header {
            font-weight: 700;
            color: var(--sg-blue);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .q-status {
            font-size: 0.8rem;
            padding: 4px 12px;
            border-radius: 20px;
            background: #ddd;
            color: #666;
        }

        .q-status.correct {
            background: var(--correct-green);
            color: white;
        }

        .q-status.wrong {
            background: var(--wrong-red);
            color: white;
        }

        /* Drag & Drop Styles */
        .bucket-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .bucket {
            flex: 1;
            background: white;
            border: 2px dashed #ccc;
            border-radius: 8px;
            min-height: 200px;
            padding: 15px;
            position: relative;
        }

        .bucket h4 {
            text-align: center;
            color: var(--sg-blue);
            margin-bottom: 10px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .draggable-source {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            min-height: 60px;
        }

        .drag-item {
            background: var(--sg-blue);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: grab;
            user-select: none;
            transition: transform 0.1s;
        }

        .drag-item:active {
            cursor: grabbing;
            transform: scale(1.05);
        }

        .drag-item.locked {
            background: var(--correct-green);
            cursor: default;
        }

        /* Dropdown Styles */
        .cloze-text {
            line-height: 2.2;
            font-size: 1.05rem;
        }

        select {
            padding: 5px 10px;
            border: 2px solid var(--sg-blue);
            border-radius: 5px;
            background: white;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            margin: 0 5px;
            font-size: 0.95rem;
        }

        select.correct {
            border-color: var(--correct-green);
            background: #e8f5e9;
            color: var(--correct-green);
            pointer-events: none;
        }

        select.wrong {
            border-color: var(--wrong-red);
            background: #f8d7da;
        }

        /* Ordering Lists */
        .order-list {
            list-style: none;
            padding: 0;
        }

        .order-item {
            background: white;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .order-num {
            font-weight: bold;
            color: var(--sg-gold);
        }

        /* Sortable List */
        .sortable-list { list-style: none; padding: 0; margin: 0; }
        .sortable-item { background: white; border: 1px solid #ccc; border-left: 4px solid var(--sg-gold); border-radius: 5px; padding: 15px; margin-bottom: 10px; cursor: grab; display: flex; align-items: center; justify-content: space-between; font-weight: 600; }
        .sortable-item:active { cursor: grabbing; transform: scale(1.02); }
        .sortable-item i { color: #ccc; }
        .sortable-list.correct .sortable-item { border-color: var(--correct-green); border-left-color: var(--correct-green); background-color: #e8f5e9; cursor: default; }
        .sortable-list.wrong .sortable-item { border-left-color: var(--wrong-red); background-color: #fff5f5; }

        /* MCQ Styles */
        .mcq-options { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .mcq-option { background: white; border: 2px solid #ccc; border-radius: 8px; padding: 15px; cursor: pointer; transition: all 0.2s; }
        .mcq-option:hover { border-color: var(--sg-gold); background: var(--sg-light-blue); }
        .mcq-option.selected { background: var(--sg-blue); color: white; border-color: var(--sg-blue); }
        .mcq-option.correct { background: var(--correct-green); color: white; border-color: var(--correct-green); pointer-events: none; }
        .mcq-option.wrong { border-color: var(--wrong-red); background: #f8d7da; }

        /* True/False Table */
        .tf-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 8px; overflow: hidden; }
        .tf-table th, .tf-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        .tf-table th { background: var(--sg-blue); color: white; }
        .tf-table th:nth-child(2), .tf-table th:nth-child(3), .tf-table td:nth-child(2), .tf-table td:nth-child(3) { text-align: center; width: 80px; }
        .tf-table input[type="radio"] { transform: scale(1.3); cursor: pointer; }
        .tf-table tr.correct-row { background: #e8f5e9; }
        .tf-table tr.wrong-row { background: #f8d7da; }

        /* Matching Pairs */
        .match-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: start;
        }

        .col-defs,
        .col-terms {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .match-term,
        .match-def {
            background: white;
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9rem;
        }

        .match-term:hover,
        .match-def:hover {
            border-color: var(--sg-gold);
            background: var(--sg-light-blue);
        }

        .match-selected {
            background: var(--sg-blue) !important;
            color: white !important;
            border-color: var(--sg-blue) !important;
        }

        .match-paired {
            background: #fff3cd !important;
            border-color: var(--paired-amber) !important;
            color: #856404 !important;
        }

        .match-solved {
            background: var(--correct-green) !important;
            color: white !important;
            border-color: var(--correct-green) !important;
            opacity: 0.8;
            pointer-events: none;
        }

        /* Footer Controls */
        .controls {
            text-align: center;
            margin-top: 40px;
        }

        .btn-submit {
            background: var(--sg-blue);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 30px;
            cursor: pointer;
            transition: background 0.3s;
            box-shadow: 0 4px 15px rgba(0, 51, 102, 0.2);
        }

        .btn-submit:hover {
            background: var(--sg-gold);
            transform: translateY(-2px);
        }

        #finalScore {
            margin-top: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--sg-blue);
            display: none;
        }

        /* Back Button */
        #back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            font-size: 1.5rem;
            color: var(--sg-blue);
            text-decoration: none;
            transition: color 0.3s;
        }

        #back-btn:hover {
            color: var(--sg-gold);
        }

        /* Logo */
        #sg-logo {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 80px;
            z-index: 1000;
        }

        .btn-return {
            background: var(--sg-grey);
            color: var(--sg-text);
            border: 2px solid #ccc;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: none;
            margin-left: 10px;
        }

        .btn-return:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        /* Completion Message */
        .completion-message {
            display: none;
            background: linear-gradient(135deg, var(--correct-green), #20c997);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }

        .completion-message h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .completion-message p {
            font-size: 1rem;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <!-- Start Modal -->
    <div id="startOverlay">
        <div id="startCard">
            <h2>Assessment</h2>
            <div class="test-name">3.4 Network Hardware</div>
            <p class="instructions">
                Answer all questions by selecting from dropdowns, dragging items, or matching pairs.
                You must get all answers correct to complete the assessment.
                Your attempts are tracked and a feedback PDF will be generated upon completion.
            </p>
            <label for="teacherSelect">Select Your Teacher</label>
            <select id="teacherSelect">
                <option value="" disabled selected>Choose teacher...</option>
                <option value="Mr Stewart">Mr Stewart</option>
                <option value="Mr Watling">Mr Watling</option>
            </select>
            <button onclick="startAssessment()">Start Assessment</button>
        </div>
    </div>

    <div id="timerDisplay" style="display:none;"><i class="fa-solid fa-clock"></i> <span id="timer">00:00</span></div>

    <!-- Back Button -->
    <a href="assessments.html" id="back-btn" title="Back to Topic 3 Assessments"><i
            class="fa-solid fa-circle-arrow-left"></i></a>

    <!-- Logo -->
    <img src="../../images/Logo.png" id="sg-logo" alt="Logo">

    <header>
        <h1>3.4 Assessment</h1>
        <p class="subtitle">NICs, MAC, IP & Routers</p>
    </header>

    <main style="display:none;">

        <!-- Q1: MAC vs IP (Categorisation) -->
        <div class="question-block" id="q1-block" data-summary="MAC vs IP">
            <div class="q-header">
                <span>Q1. MAC vs IP Addresses</span>
                <span class="q-status" id="q1-status">Unanswered</span>
            </div>
            <p>Drag the features into the correct category.</p>
            <div class="draggable-source" id="q1-source" ondrop="drop(event)" ondragover="allowDrop(event)">
                <!-- Items will be shuffled by JS -->
            </div>
            <div class="bucket-container">
                <div class="bucket" id="bucket-mac" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h4>MAC Address</h4>
                </div>
                <div class="bucket" id="bucket-ip" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <h4>IP Address</h4>
                </div>
            </div>
        </div>

        <!-- Q2: Hardware Definitions (Matching) -->
        <div class="question-block" id="q2-block" data-summary="Hardware Definitions">
            <div class="q-header">
                <span>Q2. Hardware Definitions</span>
                <span class="q-status" id="q2-status">Unanswered</span>
            </div>
            <p>Match the hardware to its function.</p>

            <div class="match-grid">
                <div class="col-defs" id="col-defs-q2">
                    <!-- Shuffled by JS -->
                </div>
                <div class="col-terms" id="col-terms-q2">
                    <!-- Shuffled by JS -->
                </div>
            </div>
        </div>

        <!-- Q3: IP Versions (Dropdown Gap Fill) -->
        <div class="question-block" id="q3-block" data-summary="IP Versions">
            <div class="q-header">
                <span>Q3. IP Versions</span>
                <span class="q-status" id="q3-status">Unanswered</span>
            </div>
            <div class="cloze-text">
                IPv4 addresses are <select id="q3a" data-answer="32"></select> bits long and written in <select id="q3b"
                    data-answer="denary"></select>.<br>
                IPv6 addresses are <select id="q3c" data-answer="128"></select> bits long and written in <select
                    id="q3d" data-answer="hexadecimal"></select>.<br>
                IPv6 was introduced because we ran out of <select id="q3e" data-answer="IPv4 addresses"></select>.<br>
                IPv6 avoids IP <select id="q3f" data-answer="collisions"></select> and has built-in security.
            </div>
        </div>

        <!-- Q4: MAC Address Format (Dropdown Gap Fill) -->
        <div class="question-block" id="q4-block" data-summary="MAC Address Format">
            <div class="q-header">
                <span>Q4. MAC Address Format</span>
                <span class="q-status" id="q4-status">Unanswered</span>
            </div>
            <div class="cloze-text">
                A MAC address is <select id="q4a" data-answer="48"></select> bits long.<br>
                It is usually written as 6 pairs of <select id="q4b" data-answer="hexadecimal"></select> digits.<br>
                The first half of the address identifies the <select id="q4c" data-answer="manufacturer"></select>.<br>
                The second half is the device's unique <select id="q4d" data-answer="serial number"></select>.<br>
                MAC addresses are hard-coded onto the <select id="q4e" data-answer="NIC"></select>.
            </div>
        </div>

        <!-- Q5: Static vs Dynamic IP (Matching) -->
        <div class="question-block" id="q5-block" data-summary="Static vs Dynamic IP">
            <div class="q-header">
                <span>Q5. Static vs Dynamic IP</span>
                <span class="q-status" id="q5-status">Unanswered</span>
            </div>
            <p>Match the IP type to its description.</p>

            <div class="match-grid">
                <div class="col-defs" id="col-defs-q5">
                    <!-- Shuffled by JS -->
                </div>
                <div class="col-terms" id="col-terms-q5">
                    <!-- Shuffled by JS -->
                </div>
            </div>
        </div>

        <!-- Q6: Router Operation (Ordering) -->
        <div class="question-block" id="q6-block" data-summary="Router Operation">
            <div class="q-header">
                <span>Q6. Router Operation</span>
                <span class="q-status" id="q6-status">Unanswered</span>
            </div>
            <p>Order the steps of how a router handles a data packet.</p>
            <div class="order-list">
                <div class="order-item"><span class="order-num">1.</span> <select id="q6a"
                        data-answer="Data packet arrives at the router"></select></div>
                <div class="order-item"><span class="order-num">2.</span> <select id="q6b"
                        data-answer="Router inspects the destination IP address"></select></div>
                <div class="order-item"><span class="order-num">3.</span> <select id="q6c"
                        data-answer="Router checks its routing table for the best path"></select></div>
                <div class="order-item"><span class="order-num">4.</span> <select id="q6d"
                        data-answer="Packet is forwarded to the next network or switch"></select></div>
                <div class="order-item"><span class="order-num">5.</span> <select id="q6e"
                        data-answer="Packet is delivered to the destination device"></select></div>
            </div>
        </div>

        <!-- Q7: DHCP Purpose (MCQ) -->
        <div class="question-block" id="q7-block" data-summary="DHCP purpose">
            <div class="q-header">
                <span>Q7. DHCP Server</span>
                <span class="q-status" id="q7-status">Unanswered</span>
            </div>
            <p>What is the main purpose of a DHCP server?</p>
            <div class="mcq-options" id="q7-options"></div>
        </div>

        <!-- Q8: Network Facts (True/False Grid) -->
        <div class="question-block" id="q8-block" data-summary="Network facts">
            <div class="q-header">
                <span>Q8. Network Facts</span>
                <span class="q-status" id="q8-status">Unanswered</span>
            </div>
            <p>Select True or False for each statement.</p>
            <table class="tf-table" id="q8-table">
                <thead><tr><th>Statement</th><th>True</th><th>False</th></tr></thead>
                <tbody id="q8-tbody"></tbody>
            </table>
        </div>

        <!-- Q9: IP Address Classes (Sortable List) -->
        <div class="question-block" id="q9-block" data-summary="IPv4 vs IPv6">
            <div class="q-header">
                <span>Q9. IPv4 to IPv6 Progression</span>
                <span class="q-status" id="q9-status">Unanswered</span>
            </div>
            <p>Drag to arrange by number of possible addresses (smallest to largest).</p>
            <ul class="sortable-list" id="q9-list"></ul>
        </div>

        <!-- Q10: NIC Functions (Dropdown) -->
        <div class="question-block" id="q10-block" data-summary="NIC functions">
            <div class="q-header">
                <span>Q10. NIC Functions</span>
                <span class="q-status" id="q10-status">Unanswered</span>
            </div>
            <div class="cloze-text">
                A NIC is a <select id="q10a" data-answer="hardware"></select> device that enables network connectivity.<br>
                Each NIC has a unique <select id="q10b" data-answer="MAC address"></select> assigned by the manufacturer.<br>
                NICs can be <select id="q10c" data-answer="wired or wireless"></select> for different connection types.<br>
                The NIC handles data <select id="q10d" data-answer="framing and transmission"></select> on the network.
            </div>
        </div>

        <div class="controls">
            <button class="btn-submit" id="btnSubmit" onclick="checkAnswers()">Submit Answers</button>
            <a href="assessments.html" class="btn-return" id="btnReturn">Return to Menu</a>
            <div id="finalScore"></div>
            <div class="completion-message" id="completionMessage">
                <h3><i class="fa-solid fa-trophy"></i> Assessment Complete!</h3>
                <p>Your feedback PDF is downloading...</p>
            </div>
        </div>

    </main>

    <script>
        // --- SESSION / TRACKING ---
        let startTime;
        let timerInterval;
        let timeTakenStr = "";
        let teacherName = "";
        const testName = "3.4 Network Hardware";

        // Attempt tracking
        const mistakeCounts = { q1: 0, q2: 0, q3: 0, q4: 0, q5: 0, q6: 0, q7: 0, q8: 0, q9: 0, q10: 0 };
        const completed = { q1: false, q2: false, q3: false, q4: false, q5: false, q6: false, q7: false, q8: false, q9: false, q10: false };
        let totalAttempts = 0;
        let assessmentFinished = false;

        // --- DATA FOR QUESTIONS ---

        // Q1 Data (MAC vs IP)
        const q1Items = [
            { id: 'm1', text: 'Physical Address', correct: 'mac' },
            { id: 'm2', text: 'Set by Manufacturer', correct: 'mac' },
            { id: 'm3', text: '48-bit Hexadecimal', correct: 'mac' },
            { id: 'm4', text: 'Stored on NIC', correct: 'mac' },
            { id: 'i1', text: 'Logical Address', correct: 'ip' },
            { id: 'i2', text: 'Assigned by Network/ISP', correct: 'ip' },
            { id: 'i3', text: '32-bit or 128-bit', correct: 'ip' },
            { id: 'i4', text: 'Can be Dynamic', correct: 'ip' }
        ];

        // Q2 Data (Hardware)
        const q2Defs = [
            { id: '1', text: 'Hardware that allows a device to connect to a network' },
            { id: '2', text: 'Connects different networks and directs data' },
            { id: '3', text: 'Automatically assigns dynamic IP addresses to devices' },
            { id: '4', text: 'Company that provides internet access and public IP addresses' }
        ];

        const q2Terms = [
            { id: '1', text: 'NIC' },
            { id: '2', text: 'Router' },
            { id: '3', text: 'DHCP Server' },
            { id: '4', text: 'ISP' }
        ];

        // Q5 Data (Static vs Dynamic)
        const q5Defs = [
            { id: '1', text: 'Permanent address, useful for web servers' },
            { id: '2', text: 'Temporary address assigned by DHCP, changes on reconnection' },
            { id: '3', text: 'Unique global address used on the internet' },
            { id: '4', text: 'Address used only within a local network (LAN)' }
        ];

        const q5Terms = [
            { id: '1', text: 'Static IP' },
            { id: '2', text: 'Dynamic IP' },
            { id: '3', text: 'Public IP' },
            { id: '4', text: 'Private IP' }
        ];

        // Dropdown Options
        const dropdownOptions = {
            q3Bits: ['32', '64', '128', '256'],
            q3Base: ['denary', 'binary', 'hexadecimal', 'octal'],
            q3Reason: ['IPv4 addresses', 'electricity', 'cables', 'routers'],
            q3Feat: ['collisions', 'explosions', 'delays', 'errors'],
            q4Bits: ['48', '32', '64', '128'],
            q4Base: ['hexadecimal', 'binary', 'denary', 'text'],
            q4Part1: ['manufacturer', 'user', 'ISP', 'country'],
            q4Part2: ['serial number', 'model number', 'date code', 'price'],
            q4Loc: ['NIC', 'CPU', 'HDD', 'RAM'],
            q6: [
                'Data packet arrives at the router',
                'Router inspects the destination IP address',
                'Router checks its routing table for the best path',
                'Packet is forwarded to the next network or switch',
                'Packet is delivered to the destination device'
            ]
        };

        // Q7 MCQ Data
        const q7Options = [
            { text: 'To automatically assign IP addresses to devices', correct: true },
            { text: 'To encrypt network traffic', correct: false },
            { text: 'To connect different networks together', correct: false },
            { text: 'To store MAC addresses', correct: false }
        ];
        let q7Selected = null;

        // Q8 True/False Data
        const q8Statements = [
            { id: 'tf1', text: 'A MAC address can be changed by the user', correct: false },
            { id: 'tf2', text: 'IPv6 uses 128 bits for addresses', correct: true },
            { id: 'tf3', text: 'Dynamic IP addresses are permanently assigned', correct: false },
            { id: 'tf4', text: 'Routers connect different networks together', correct: true }
        ];

        // Q9 Sortable Data (address space smallest to largest)
        const q9Items = [
            { id: 'a1', text: 'IPv4 (4.3 billion addresses)', order: 1 },
            { id: 'a2', text: 'IPv6 (trillions of addresses)', order: 2 }
        ];

        // Q10 Dropdown Options
        const q10Options = {
            q10a: ['hardware', 'software', 'protocol'],
            q10b: ['MAC address', 'IP address', 'domain name'],
            q10c: ['wired or wireless', 'only wired', 'only wireless'],
            q10d: ['framing and transmission', 'encryption', 'storage']
        };

        // Question Metadata
        const questionMeta = [
            { id: 'q1', title: 'MAC vs IP', type: 'drag', correctAnswer: { mac: ['Physical Address', 'Set by Manufacturer', '48-bit Hexadecimal', 'Stored on NIC'], ip: ['Logical Address', 'Assigned by Network/ISP', '32-bit or 128-bit', 'Can be Dynamic'] } },
            { id: 'q2', title: 'Hardware', type: 'match', correctAnswer: { '1': 'NIC', '2': 'Router', '3': 'DHCP Server', '4': 'ISP' } },
            { id: 'q3', title: 'IP Versions', type: 'dropdown', correctAnswer: { a: '32', b: 'denary', c: '128', d: 'hexadecimal', e: 'IPv4 addresses', f: 'collisions' } },
            { id: 'q4', title: 'MAC Format', type: 'dropdown', correctAnswer: { a: '48', b: 'hexadecimal', c: 'manufacturer', d: 'serial number', e: 'NIC' } },
            { id: 'q5', title: 'IP Types', type: 'match', correctAnswer: { '1': 'Static IP', '2': 'Dynamic IP', '3': 'Public IP', '4': 'Private IP' } },
            { id: 'q6', title: 'Router Ops', type: 'order', correctAnswer: ['Data packet arrives at the router', 'Router inspects the destination IP address', 'Router checks its routing table for the best path', 'Packet is forwarded to the next network or switch', 'Packet is delivered to the destination device'] },
            { id: 'q7', title: 'DHCP', type: 'mcq', correctAnswer: 'To automatically assign IP addresses to devices' },
            { id: 'q8', title: 'Network Facts', type: 'trueFalse', correctAnswer: { tf1: false, tf2: true, tf3: false, tf4: true } },
            { id: 'q9', title: 'IP Versions', type: 'sortable', correctAnswer: ['IPv4 (4.3 billion addresses)', 'IPv6 (trillions of addresses)'] },
            { id: 'q10', title: 'NIC Functions', type: 'dropdown', correctAnswer: { a: 'hardware', b: 'MAC address', c: 'wired or wireless', d: 'framing and transmission' } }
        ];

        // --- UTILITY: Shuffle Array ---
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // --- INITIALIZE ALL SHUFFLED CONTENT ---
        function initQuestions() {
            // Q1 Drag & Drop
            const q1S = shuffle(q1Items);
            const q1Source = document.getElementById('q1-source');
            q1S.forEach(item => {
                const div = document.createElement('div');
                div.className = 'drag-item';
                div.draggable = true;
                div.id = item.id;
                div.textContent = item.text;
                div.dataset.correct = item.correct;
                div.ondragstart = drag;
                q1Source.appendChild(div);
            });

            // Q2 Matching
            const q2D = shuffle(q2Defs);
            const q2T = shuffle(q2Terms);
            const defsContainerQ2 = document.getElementById('col-defs-q2');
            const termsContainerQ2 = document.getElementById('col-terms-q2');

            q2D.forEach(d => {
                const div = document.createElement('div');
                div.className = 'match-def';
                div.dataset.id = d.id;
                div.textContent = d.text;
                div.onclick = () => selectDef(div, 'q2');
                defsContainerQ2.appendChild(div);
            });

            q2T.forEach(t => {
                const div = document.createElement('div');
                div.className = 'match-term';
                div.dataset.id = t.id;
                div.textContent = t.text;
                div.onclick = () => selectTerm(div, 'q2');
                termsContainerQ2.appendChild(div);
            });

            // Q3 Dropdowns
            populateDropdown('q3a', dropdownOptions.q3Bits);
            populateDropdown('q3b', dropdownOptions.q3Base);
            populateDropdown('q3c', dropdownOptions.q3Bits);
            populateDropdown('q3d', dropdownOptions.q3Base);
            populateDropdown('q3e', dropdownOptions.q3Reason);
            populateDropdown('q3f', dropdownOptions.q3Feat);

            // Q4 Dropdowns
            populateDropdown('q4a', dropdownOptions.q4Bits);
            populateDropdown('q4b', dropdownOptions.q4Base);
            populateDropdown('q4c', dropdownOptions.q4Part1);
            populateDropdown('q4d', dropdownOptions.q4Part2);
            populateDropdown('q4e', dropdownOptions.q4Loc);

            // Q5 Matching
            const q5D = shuffle(q5Defs);
            const q5T = shuffle(q5Terms);
            const defsContainerQ5 = document.getElementById('col-defs-q5');
            const termsContainerQ5 = document.getElementById('col-terms-q5');

            q5D.forEach(d => {
                const div = document.createElement('div');
                div.className = 'match-def';
                div.dataset.id = d.id;
                div.textContent = d.text;
                div.onclick = () => selectDef(div, 'q5');
                defsContainerQ5.appendChild(div);
            });

            q5T.forEach(t => {
                const div = document.createElement('div');
                div.className = 'match-term';
                div.dataset.id = t.id;
                div.textContent = t.text;
                div.onclick = () => selectTerm(div, 'q5');
                termsContainerQ5.appendChild(div);
            });

            // Q6 Ordering
            populateDropdown('q6a', dropdownOptions.q6);
            populateDropdown('q6b', dropdownOptions.q6);
            populateDropdown('q6c', dropdownOptions.q6);
            populateDropdown('q6d', dropdownOptions.q6);
            populateDropdown('q6e', dropdownOptions.q6);

            // Q7 MCQ
            const q7Container = document.getElementById('q7-options');
            shuffle(q7Options).forEach(opt => {
                const div = document.createElement('div');
                div.className = 'mcq-option';
                div.dataset.correct = opt.correct;
                div.dataset.value = opt.text;
                div.textContent = opt.text;
                div.onclick = () => selectMCQ(div, 'q7');
                q7Container.appendChild(div);
            });

            // Q8 True/False Grid
            const q8Tbody = document.getElementById('q8-tbody');
            shuffle(q8Statements).forEach(stmt => {
                const tr = document.createElement('tr');
                tr.dataset.id = stmt.id;
                tr.dataset.correct = stmt.correct;
                tr.innerHTML = `<td>${stmt.text}</td><td><input type="radio" name="${stmt.id}" value="true"></td><td><input type="radio" name="${stmt.id}" value="false"></td>`;
                q8Tbody.appendChild(tr);
            });

            // Q9 Sortable List
            const q9List = document.getElementById('q9-list');
            shuffle(q9Items).forEach(item => {
                const li = document.createElement('li');
                li.className = 'sortable-item';
                li.draggable = true;
                li.dataset.order = item.order;
                li.innerHTML = `${item.text} <i class="fa-solid fa-grip-lines"></i>`;
                li.ondragstart = dragSortable;
                li.ondragover = dragOverSortable;
                li.ondrop = dropSortable;
                q9List.appendChild(li);
            });

            // Q10 Dropdowns
            populateDropdown('q10a', q10Options.q10a);
            populateDropdown('q10b', q10Options.q10b);
            populateDropdown('q10c', q10Options.q10c);
            populateDropdown('q10d', q10Options.q10d);
        }

        function selectMCQ(el, qId) {
            if (completed[qId]) return;
            el.parentElement.querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
            if (qId === 'q7') q7Selected = el.dataset.value;
        }

        let draggedSortable = null;
        function dragSortable(ev) { draggedSortable = ev.target; ev.target.style.opacity = '0.5'; }
        function dragOverSortable(ev) { ev.preventDefault(); }
        function dropSortable(ev) {
            ev.preventDefault();
            if (ev.target.classList.contains('sortable-item') && draggedSortable !== ev.target) {
                const items = Array.from(ev.target.parentElement.children);
                if (items.indexOf(draggedSortable) < items.indexOf(ev.target)) ev.target.after(draggedSortable);
                else ev.target.before(draggedSortable);
            }
            draggedSortable.style.opacity = '1';
            draggedSortable = null;
        }

        function populateDropdown(id, options) {
            const select = document.getElementById(id);
            const shuffled = shuffle(options);
            const defaultOpt = document.createElement('option');
            defaultOpt.value = "";
            defaultOpt.textContent = "---";
            select.appendChild(defaultOpt);
            shuffled.forEach(opt => {
                const el = document.createElement('option');
                el.value = opt;
                el.textContent = opt;
                select.appendChild(el);
            });
        }

        // --- CORE LOGIC ---
        function startAssessment() {
            const teacher = document.getElementById('teacherSelect').value;
            if (!teacher) {
                alert("Please select your teacher.");
                return;
            }
            teacherName = teacher;
            document.getElementById('startOverlay').style.display = 'none';
            document.querySelector('main').style.display = 'block';
            document.getElementById('timerDisplay').style.display = 'block';
            startTime = new Date();
            timerInterval = setInterval(updateTimer, 1000);
            initQuestions();
        }

        function updateTimer() {
            const now = new Date();
            const diff = Math.floor((now - startTime) / 1000);
            const m = Math.floor(diff / 60).toString().padStart(2, '0');
            const s = (diff % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${m}:${s}`;
            timeTakenStr = `${m}m ${s}s`;
        }

        // --- DRAG & DROP ---
        function allowDrop(ev) { ev.preventDefault(); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev) {
            ev.preventDefault();
            const data = ev.dataTransfer.getData("text");
            const el = document.getElementById(data);
            if (ev.target.classList.contains('bucket') || ev.target.classList.contains('draggable-source')) {
                ev.target.appendChild(el);
            } else if (ev.target.closest('.bucket')) {
                ev.target.closest('.bucket').appendChild(el);
            }
        }

        // --- MATCHING LOGIC (Generic) ---
        let selectedDef = { q2: null, q5: null };
        let selectedTerm = { q2: null, q5: null };
        let matchedPairs = { q2: [], q5: [] };

        function selectDef(el, qId) {
            if (el.classList.contains('match-solved')) return;
            if (selectedDef[qId]) selectedDef[qId].classList.remove('match-selected');
            selectedDef[qId] = el;
            el.classList.add('match-selected');
            checkMatch(qId);
        }

        function selectTerm(el, qId) {
            if (el.classList.contains('match-solved')) return;
            if (selectedTerm[qId]) selectedTerm[qId].classList.remove('match-selected');
            selectedTerm[qId] = el;
            el.classList.add('match-selected');
            checkMatch(qId);
        }

        function checkMatch(qId) {
            if (selectedDef[qId] && selectedTerm[qId]) {
                selectedDef[qId].classList.remove('match-selected');
                selectedTerm[qId].classList.remove('match-selected');
                selectedDef[qId].classList.add('match-paired');
                selectedTerm[qId].classList.add('match-paired');
                matchedPairs[qId] = matchedPairs[qId].filter(p => p.def !== selectedDef[qId] && p.term !== selectedTerm[qId]);
                matchedPairs[qId].push({
                    def: selectedDef[qId],
                    term: selectedTerm[qId],
                    defId: selectedDef[qId].dataset.id,
                    termId: selectedTerm[qId].dataset.id
                });
                selectedDef[qId] = null;
                selectedTerm[qId] = null;
            }
        }

        // --- CHECK ANSWERS ---
        function checkAnswers() {
            totalAttempts++;
            let allCorrect = true;

            // Q1: Drag & Drop
            const bucketMac = document.getElementById('bucket-mac');
            const bucketIp = document.getElementById('bucket-ip');
            let q1Correct = true;

            Array.from(bucketMac.children).forEach(child => {
                if (child.classList.contains('drag-item')) {
                    if (child.dataset.correct !== 'mac') q1Correct = false;
                }
            });
            Array.from(bucketIp.children).forEach(child => {
                if (child.classList.contains('drag-item')) {
                    if (child.dataset.correct !== 'ip') q1Correct = false;
                }
            });
            if (document.getElementById('q1-source').children.length > 0) q1Correct = false;

            if (q1Correct) {
                markCorrect('q1');
                lockDragItems([bucketMac, bucketIp]);
            } else {
                markWrong('q1');
                allCorrect = false;
            }

            // Q2: Matching
            let q2Correct = true;
            const q2Pairs = matchedPairs.q2;
            if (q2Pairs.length !== 4) q2Correct = false;
            else {
                q2Pairs.forEach(p => {
                    if (p.defId !== p.termId) q2Correct = false;
                });
            }

            if (q2Correct) {
                markCorrect('q2');
                q2Pairs.forEach(p => {
                    p.def.classList.remove('match-paired');
                    p.term.classList.remove('match-paired');
                    p.def.classList.add('match-solved');
                    p.term.classList.add('match-solved');
                });
            } else {
                markWrong('q2');
                allCorrect = false;
            }

            // Q3: Dropdowns
            const q3a = document.getElementById('q3a');
            const q3b = document.getElementById('q3b');
            const q3c = document.getElementById('q3c');
            const q3d = document.getElementById('q3d');
            const q3e = document.getElementById('q3e');
            const q3f = document.getElementById('q3f');

            if (checkSelect(q3a) && checkSelect(q3b) && checkSelect(q3c) && checkSelect(q3d) && checkSelect(q3e) && checkSelect(q3f)) {
                markCorrect('q3');
            } else {
                markWrong('q3');
                allCorrect = false;
            }

            // Q4: Dropdowns
            const q4a = document.getElementById('q4a');
            const q4b = document.getElementById('q4b');
            const q4c = document.getElementById('q4c');
            const q4d = document.getElementById('q4d');
            const q4e = document.getElementById('q4e');

            if (checkSelect(q4a) && checkSelect(q4b) && checkSelect(q4c) && checkSelect(q4d) && checkSelect(q4e)) {
                markCorrect('q4');
            } else {
                markWrong('q4');
                allCorrect = false;
            }

            // Q5: Matching
            let q5Correct = true;
            const q5Pairs = matchedPairs.q5;
            if (q5Pairs.length !== 4) q5Correct = false;
            else {
                q5Pairs.forEach(p => {
                    if (p.defId !== p.termId) q5Correct = false;
                });
            }

            if (q5Correct) {
                markCorrect('q5');
                q5Pairs.forEach(p => {
                    p.def.classList.remove('match-paired');
                    p.term.classList.remove('match-paired');
                    p.def.classList.add('match-solved');
                    p.term.classList.add('match-solved');
                });
            } else {
                markWrong('q5');
                allCorrect = false;
            }

            // Q6: Ordering
            const q6a = document.getElementById('q6a');
            const q6b = document.getElementById('q6b');
            const q6c = document.getElementById('q6c');
            const q6d = document.getElementById('q6d');
            const q6e = document.getElementById('q6e');

            if (q6a.value === 'Data packet arrives at the router' &&
                q6b.value === 'Router inspects the destination IP address' &&
                q6c.value === 'Router checks its routing table for the best path' &&
                q6d.value === 'Packet is forwarded to the next network or switch' &&
                q6e.value === 'Packet is delivered to the destination device') {
                markCorrect('q6');
                q6a.classList.add('correct');
                q6b.classList.add('correct');
                q6c.classList.add('correct');
                q6d.classList.add('correct');
                q6e.classList.add('correct');
            } else {
                markWrong('q6');
                allCorrect = false;
                if (q6a.value !== 'Data packet arrives at the router') q6a.classList.add('wrong');
                if (q6b.value !== 'Router inspects the destination IP address') q6b.classList.add('wrong');
                if (q6c.value !== 'Router checks its routing table for the best path') q6c.classList.add('wrong');
                if (q6d.value !== 'Packet is forwarded to the next network or switch') q6d.classList.add('wrong');
                if (q6e.value !== 'Packet is delivered to the destination device') q6e.classList.add('wrong');
            }

            // Q7: MCQ
            if (q7Selected === 'To automatically assign IP addresses to devices') {
                markCorrect('q7');
                document.querySelectorAll('#q7-options .mcq-option').forEach(opt => { if (opt.dataset.correct === 'true') opt.classList.add('correct'); });
            } else {
                markWrong('q7');
                allCorrect = false;
                document.querySelectorAll('#q7-options .mcq-option.selected').forEach(opt => opt.classList.add('wrong'));
            }

            // Q8: True/False Grid
            let q8Correct = true;
            document.querySelectorAll('#q8-tbody tr').forEach(row => {
                const selected = row.querySelector('input[type="radio"]:checked');
                if (!selected || selected.value !== row.dataset.correct) { q8Correct = false; row.classList.add('wrong-row'); }
                else row.classList.add('correct-row');
            });
            if (q8Correct) markCorrect('q8'); else { markWrong('q8'); allCorrect = false; }

            // Q9: Sortable List
            const q9List = document.getElementById('q9-list');
            const q9Order = Array.from(q9List.children).map(item => parseInt(item.dataset.order));
            if (q9Order.every((val, idx, arr) => idx === 0 || arr[idx - 1] < val) && q9Order.length === 2) {
                markCorrect('q9'); q9List.classList.add('correct');
            } else { markWrong('q9'); q9List.classList.add('wrong'); allCorrect = false; }

            // Q10: Dropdowns
            const q10a = document.getElementById('q10a'), q10b = document.getElementById('q10b');
            const q10c = document.getElementById('q10c'), q10d = document.getElementById('q10d');
            if (checkSelect(q10a) && checkSelect(q10b) && checkSelect(q10c) && checkSelect(q10d)) markCorrect('q10');
            else { markWrong('q10'); allCorrect = false; }

            // Final Completion
            if (allCorrect && !assessmentFinished) {
                assessmentFinished = true;
                clearInterval(timerInterval);
                document.getElementById('btnSubmit').style.display = 'none';
                document.getElementById('btnReturn').style.display = 'inline-block';
                document.getElementById('completionMessage').style.display = 'block';
                document.getElementById('finalScore').textContent = `Attempts: ${totalAttempts} | Time: ${timeTakenStr}`;
                document.getElementById('finalScore').style.display = 'block';
                generatePDF();
            }
        }

        function checkSelect(el) {
            if (el.value === el.dataset.answer) {
                el.classList.add('correct');
                el.classList.remove('wrong');
                return true;
            } else {
                el.classList.add('wrong');
                return false;
            }
        }

        function markCorrect(qId) {
            if (!completed[qId]) {
                completed[qId] = true;
                document.getElementById(`${qId}-status`).textContent = "Correct";
                document.getElementById(`${qId}-status`).className = "q-status correct";
                document.getElementById(`${qId}-block`).style.borderLeftColor = "var(--correct-green)";
            }
        }

        function markWrong(qId) {
            if (!completed[qId]) {
                mistakeCounts[qId]++;
                document.getElementById(`${qId}-status`).textContent = "Incorrect";
                document.getElementById(`${qId}-status`).className = "q-status wrong";
            }
        }

        function lockDragItems(containers) {
            containers.forEach(c => {
                Array.from(c.children).forEach(child => {
                    if (child.classList.contains('drag-item')) {
                        child.draggable = false;
                        child.classList.add('locked');
                    }
                });
            });
        }

        // --- PDF GENERATION ---
        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // Page 1: Answers
            doc.setFontSize(20);
            doc.setTextColor(0, 51, 102);
            doc.text(testName, 20, 20);

            doc.setFontSize(12);
            doc.setTextColor(50);
            doc.text(`Teacher: ${teacherName}`, 20, 30);
            doc.text(`Time Taken: ${timeTakenStr}`, 20, 36);
            doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 42);

            let y = 60;
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text("Correct Answers & Justifications", 20, 52);

            doc.setFontSize(10);
            questionMeta.forEach(q => {
                if (y > 270) { doc.addPage(); y = 20; }

                doc.setFont(undefined, 'bold');
                doc.text(`${q.id.toUpperCase()}: ${q.title}`, 20, y);
                y += 5;

                doc.setFont(undefined, 'normal');
                let ansStr = "";
                if (typeof q.correctAnswer === 'object') {
                    ansStr = JSON.stringify(q.correctAnswer).replace(/"/g, '').replace(/,/g, ', ');
                } else {
                    ansStr = q.correctAnswer;
                }

                const splitAns = doc.splitTextToSize(`Answer: ${ansStr}`, 170);
                doc.text(splitAns, 20, y);
                y += (splitAns.length * 5) + 5;
            });

            // Page 2: Feedback
            doc.addPage();
            doc.setFontSize(16);
            doc.text("Feedback & Reflection", 20, 20);

            // Table Header
            let ty = 40;
            doc.setFontSize(10);
            doc.setFillColor(240, 240, 240);
            doc.rect(20, ty - 5, 170, 8, 'F');
            doc.text("Question", 25, ty);
            doc.text("Attempts", 80, ty);
            doc.text("Feedback Code", 130, ty);
            ty += 10;

            // Table Rows
            Object.keys(mistakeCounts).forEach(q => {
                doc.text(q.toUpperCase(), 25, ty);
                doc.text((mistakeCounts[q] + 1).toString(), 85, ty);
                doc.rect(130, ty - 4, 30, 6);
                ty += 10;
            });

            // Key
            ty += 10;
            doc.setFont(undefined, 'bold');
            doc.text("Feedback Codes:", 20, ty);
            ty += 6;
            doc.setFont(undefined, 'normal');
            doc.text("C: Content gap", 20, ty); ty += 5;
            doc.text("E: Exam technique", 20, ty); ty += 5;
            doc.text("L: Language/clarity", 20, ty); ty += 5;
            doc.text("T: Time/effort", 20, ty); ty += 5;
            doc.text("M: Misread/misapplied", 20, ty);

            // Reflection Boxes
            ty += 15;
            doc.setDrawColor(40, 167, 69); // Green
            doc.setLineWidth(1);
            doc.rect(20, ty, 170, 40);
            doc.setTextColor(40, 167, 69);
            doc.text("Student Reflection:", 25, ty + 8);

            ty += 50;
            doc.setDrawColor(111, 66, 193); // Purple
            doc.rect(20, ty, 170, 40);
            doc.setTextColor(111, 66, 193);
            doc.text("Teacher Comment:", 25, ty + 8);

            doc.save(`${testName.replace(/ /g, '_')}_Feedback.pdf`);
        }
    </script>
</body>

</html>